{"version":3,"sources":["components/labels.js","components/Sidebar.js","components/util.js","components/Timeline.js","components/Toolbar.js","components/VideoLabeler.js","reducer.js","components/Labeler.js","App.js","reportWebVitals.js","index.js"],"names":["LabelsDispatch","createContext","SidebarAgentsPresent","state","dispatch","useContext","className","agents","map","agent","SidebarAgentPresent","active","name","activeAgent","onActivate","type","checked","agentPresent","onChange","event","isPresent","currentTarget","flipped","agentFlipped","onFlip","isFlipped","Form","Check","id","label","display_name","symmetrical","SidebarAgentAnnotation","onClick","FormCheck","isBlurred","agentName","isObscured","SidebarAgentAnnotations","frames","activeFrame","Object","values","every","x","Sidebar","Col","md","lg","xl","apiBaseUrl","getSrcForFrame","sampleId","getComponentType","i","UpdatingPopover","forwardRef","ref","popper","children","props","show","useEffect","scheduleUpdate","Popover","body","Timeline","sample","components","useMemo","lastComponentType","componentLength","numFrames","componentType","push","useState","hoverPositionPercent","setHoverPositionPercent","wantsToNavigateToFrame","setWantsToNavigateToFrame","hoverPositionFrame","Math","min","floor","Modal","onHide","Header","closeButton","Title","Body","Footer","Button","variant","frame","onMouseMove","bounds","getBoundingClientRect","pct","clientX","width","max","preventDefault","onMouseLeave","OverlayTrigger","placement","overlay","src","alt","height","style","left","flexGrow","Toolbar","returnToIndex","helpVisible","setHelpVisible","Navbar","Nav","Text","Spinner","animation","size","loading","ButtonGroup","disabled","sampleRate","Dropdown","Toggle","dishMask","locked","verticalAlign","Menu","Item","value","Card","border","transform","y","angle","matrix","DOMMatrix","cos","sin","multiplySelf","DISH_MASK","Symbol","VideoLabeler","preloadCanvas","setPreloadCanvas","image","setImage","element","document","createElement","imageLoaded","addEventListener","removeEventListener","dishMaskLocation","naturalWidth","naturalHeight","radius","canvas","setCanvas","getContext","save","ctx","restore","fillStyle","fillRect","beginPath","arc","PI","clip","getAgentLocation","useCallback","Error","console","assert","agentLabel","eventToImageCoordinates","nativeEvent","offsetX","clientHeight","offsetY","clientWidth","setTransform","drawImage","lineWidth","strokeStyle","shape","shapeX","shapeY","lineTo","stroke","fill","activeAgentLabel","Image","drag","setDrag","startDrag","mouse","getHoveredAgent","agentPos","xTranslated","yTranslated","xRotated","yRotated","point_in_polygon","isDishMaskHovered","mouseX","mouseY","dishX","dishY","isDragging","onMouseDown","hoveredAgent","onMouseUp","xDelta","yDelta","onWheel","agentToScroll","deltaY","shiftKey","by","updateFrame","changes","clampFrame","settings","frameNum","round","reducer","action","warn","current","presentAgentNames","keys","filter","length","idx","indexOf","stepAdvanceDispatch","reverse","stepRetreatDispatch","defaultState","NO_MATCH","Labeler","useReducer","setSample","experimentId","URL","window","location","searchParams","get","controller","AbortController","signal","fetch","then","response","json","aborted","log","catch","err","alert","abort","listener","ret","key","hasSample","save_state","fromEntries","method","credentials","headers","JSON","stringify","Container","fluid","Row","Provider","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.fee83ab3.chunk.js","sourcesContent":["import { createContext } from \"react\"\n\nexport const LabelsDispatch = createContext({})","import { Col, Form, FormCheck } from \"react-bootstrap\"\n\nimport agents from \"../agents.json\"\nimport { useContext } from \"react\"\nimport { LabelsDispatch } from \"./labels\"\n\nimport \"./Sidebar.css\"\n\nfunction SidebarAgentsPresent({ state }) {\n    const dispatch = useContext(LabelsDispatch)\n    if (!dispatch) return null\n\n    return <div>\n        <h4 className=\"text-center mt-3\">Agents Present</h4>\n        <p className=\"small text-secondary text-center\">Applies to the entire video</p>\n\n        <ol className=\"list-unstyled m-3\">\n            {agents.map(agent => (\n                <SidebarAgentPresent\n                    key={agent.name}\n                    agent={agent}\n                    active={agent.name === state.activeAgent}\n                    onActivate={() => dispatch({\n                        type: 'set_active_agent',\n                        activeAgent: agent.name\n                    })}\n                    checked={state.agentPresent?.[agent.name] ?? false}\n                    onChange={event => dispatch({\n                        type: 'set_agent_present',\n                        agent: agent.name,\n                        isPresent: event.currentTarget.checked\n                    })}\n                    flipped={state.agentFlipped?.[agent.name] ?? false}\n                    onFlip={event => dispatch({\n                        type: 'set_agent_flipped',\n                        agent: agent.name,\n                        isFlipped: event.currentTarget.checked\n                    })}\n                />\n            ))}\n        </ol>\n    </div>\n}\n\nfunction SidebarAgentPresent({ agent, checked, onChange, flipped, onFlip }) {\n    return (<li>\n        <Form.Check\n            type=\"checkbox\"\n            id={agent.name + \"-active\"}\n            label={agent.display_name}\n            checked={checked}\n            onChange={onChange}\n        />\n        {!agent.symmetrical && <Form.Check\n            className=\"indented-checkbox\"\n            type=\"checkbox\"\n            id={agent.name + \"-flip\"}\n            label=\"Flip\"\n            checked={flipped}\n            onChange={onFlip}\n        />}\n    </li>)\n}\n\nfunction SidebarAgentAnnotation({ state, agent, label }) {\n    const dispatch = useContext(LabelsDispatch)\n    if (!dispatch) return null\n\n    return <li\n        className={\"list-group-item py-2 px-3 \" + (state.activeAgent === agent.name ? 'active' : '')}\n        onClick={() => dispatch({ type: 'set_active_agent', activeAgent: agent.name })}\n    >\n        {agent.display_name}\n        <Form>\n            <FormCheck\n                id={`agent-${agent.name}-blurred`}\n                label={\"Blurred\"}\n                checked={label?.isBlurred ?? false}\n                onChange={event => dispatch({\n                    type: 'set_agent_is_blurred',\n                    agentName: agent.name,\n                    isBlurred: event.currentTarget.checked\n                })}\n            />\n            <FormCheck\n                id={`agent-${agent.name}-obscured`}\n                label={\"Obscured\"}\n                checked={label?.isObscured ?? false}\n                onChange={event => dispatch({\n                    type: 'set_agent_is_obscured',\n                    agentName: agent.name,\n                    isObscured: event.currentTarget.checked\n                })}\n            />\n        </Form>\n    </li>\n}\n\nfunction SidebarAgentAnnotations({ state }) {\n    return <div className=\"flex-grow-1\">\n        <h4 className=\"text-center mt-3\">Agent Annotations</h4>\n        <p className=\"small text-secondary text-center\">Applies to the current frame</p>\n\n        <ul className=\"list-group list-group-flush\">\n            {agents.map(agent =>\n                state.agentPresent?.[agent.name] &&\n                <SidebarAgentAnnotation\n                    key={agent.name}\n                    state={state}\n                    agent={agent}\n                    label={state.frames?.[state.activeFrame]?.[agent.name]}\n                />\n            )}\n        </ul>\n        {Object.values(state.agentPresent).every(x => !x) && <p className=\"text-center mx-2\">\n            Use the checkboxes below to select the agents that are present in this video\n        </p>}\n    </div>\n}\n\nexport function Sidebar({ state }) {\n\n    return (<Col md={4} lg={3} xl={2} className=\"bg-light h-100 border-end border-dark d-flex flex-column gx-0\">\n        <SidebarAgentAnnotations state={state} />\n        <SidebarAgentsPresent state={state} />\n    </Col>)\n}","// export const apiBaseUrl = ''\nexport const apiBaseUrl = '//127.0.0.1:8011'\n\nexport function getSrcForFrame(sampleId, activeFrame) {\n    if (!sampleId) return \"\"\n    return `${apiBaseUrl}/api/frame.jpg?experiment=${sampleId}&frame=${activeFrame}`\n}","import { forwardRef, useContext, useEffect, useMemo, useState } from \"react\"\n\nimport \"./Timeline.css\"\nimport { Button, Modal, OverlayTrigger, Popover } from \"react-bootstrap\"\nimport { getSrcForFrame } from \"./util\"\nimport { LabelsDispatch } from \"./labels\"\n\nfunction getComponentType(state, i) {\n    if (i === state.activeFrame) return 'active'\n    return state.frames?.[i] ? 'labeled' : 'unlabeled'\n}\n\n// The shell of this component is copied straight from react-bootstrap documentation\nconst UpdatingPopover = forwardRef(\n    ({ popper, children, show: _, ...props }, ref) => {\n        useEffect(() => {\n            popper.scheduleUpdate()\n        }, [children, popper])\n\n        return (\n            <Popover ref={ref} body {...props}>\n                {children}\n            </Popover>\n        )\n    },\n)\n\n\nexport function Timeline({ sample, state }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    const components = useMemo(() => {\n        const components = []\n        let lastComponentType = null\n        let componentLength = 0\n        for (let i = 1; i <= sample.numFrames; i++) {\n            const componentType = getComponentType(state, i)\n            if (componentType !== lastComponentType && lastComponentType !== null) {\n                components.push({ componentType: lastComponentType, componentLength })\n                componentLength = 0\n            }\n            componentLength += 1\n            lastComponentType = componentType\n        }\n\n        if (componentLength !== 0) {\n            components.push({ componentType: lastComponentType, componentLength })\n        }\n        return components\n    }, [sample.numFrames, state])\n\n    const [hoverPositionPercent, setHoverPositionPercent] = useState(null)\n    const [wantsToNavigateToFrame, setWantsToNavigateToFrame] = useState(null)\n\n    function onMouseMove(event) {\n        const bounds = event.currentTarget.getBoundingClientRect()\n        const pct = (event.clientX - bounds.x) / bounds.width\n\n        // Clamp to [0, 1]\n        setHoverPositionPercent(Math.max(0, Math.min(pct, 1)))\n        event.preventDefault()\n    }\n\n    function onMouseLeave() {\n        setHoverPositionPercent(null)\n    }\n\n    // This floor operation could return the `sample.numFrames`th frame, which doesn't exist\n    const hoverPositionFrame = hoverPositionPercent === null ? null :\n        Math.min(Math.floor(hoverPositionPercent * sample.numFrames), sample.numFrames - 1)\n\n    function onClick() {\n        setWantsToNavigateToFrame(hoverPositionFrame)\n    }\n\n    // This noinspection is because WebStorm thinks all arguments to OverlayTrigger are required, but most are optional\n    // noinspection RequiredAttributes\n    return (<>\n        <Modal show={wantsToNavigateToFrame !== null} onHide={() => setWantsToNavigateToFrame(null)}>\n            <Modal.Header closeButton>\n                <Modal.Title>Jump to frame {wantsToNavigateToFrame}?</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <p>\n                    You will automatically start annotating at this position. Removing annotations is not yet supported,\n                    so be sure this is the frame you want.\n                </p>\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={() => setWantsToNavigateToFrame(null)} variant=\"secondary\">Cancel</Button>\n                <Button onClick={() => {\n                    dispatch({ type: 'jump_to_frame', frame: wantsToNavigateToFrame })\n                    setWantsToNavigateToFrame(null)\n                }}\n                        variant=\"primary\">Jump to frame</Button>\n            </Modal.Footer>\n        </Modal>\n\n        <div className=\"timeline\"\n                 onMouseMove={onMouseMove}\n                 onMouseLeave={onMouseLeave}\n                 onClick={onClick}>\n\n            {hoverPositionFrame !== null && <OverlayTrigger show={true} placement={'top'} overlay={\n                <UpdatingPopover className=\"p-0\">\n                    <img\n                        src={getSrcForFrame(sample.id, hoverPositionFrame)}\n                        alt={`Frame ${hoverPositionFrame}`}\n                        height={180}\n                    />\n                </UpdatingPopover>\n            }>\n                <div className=\"timeline-cursor\" style={{\n                    width: `min(2px, ${100 / sample.numFrames}%)`,\n                    left: `${100 * hoverPositionFrame / sample.numFrames}%`,\n                }} />\n            </OverlayTrigger>}\n            {components.map(({ componentType, componentLength }, i) => (\n                <div key={i}\n                     className={`timeline-component timeline-component-${componentType}`}\n                     style={{ flexGrow: componentLength }} />\n            ))}\n        </div>\n    </>)\n}","import { useContext, useState } from \"react\"\nimport { LabelsDispatch } from \"./labels\"\nimport { Button, ButtonGroup, Card, Dropdown, Nav, Navbar, Spinner } from \"react-bootstrap\"\nimport { AiFillStepForward, AiFillStepBackward } from \"react-icons/ai\"\nimport { BiHelpCircle } from \"react-icons/bi\"\nimport { CgCloseR } from \"react-icons/cg\"\nimport { ImLock, ImUnlocked } from \"react-icons/im\"\n\nexport function Toolbar({ sample, state, returnToIndex }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    const [helpVisible, setHelpVisible] = useState(false)\n    return (<>\n        <Navbar className=\"d-flex justify-content-between\">\n            {/* Left */}\n            <Nav>\n                <Navbar.Text>\n                    <Spinner animation=\"border\" size=\"sm\" className={`me-2 ${state.loading ? 'visible' : 'invisible'}`} />\n                    Frame {state.activeFrame} of {sample.numFrames}\n                </Navbar.Text>\n            </Nav>\n\n            {/* Center */}\n            <Nav>\n                <ButtonGroup>\n                    <Button\n                        onClick={() => dispatch({ type: 'previous_frame' })}\n                        disabled={state.activeFrame <= 1}\n                    ><AiFillStepBackward /></Button>\n                    <Button\n                        onClick={() => dispatch({ type: 'next_frame' })}\n                        disabled={state.activeFrame + sample.sampleRate > sample.numFrames}\n                    ><AiFillStepForward /></Button>\n                </ButtonGroup>\n            </Nav>\n\n            {/* Right */}\n            <Nav>\n                <Dropdown>\n                    <Dropdown.Toggle>\n                        {state.dishMask?.locked ?\n                            <ImLock style={{ verticalAlign: \"text-top\" }} /> :\n                            <ImUnlocked style={{ verticalAlign: \"text-top\" }} />} Dish mask\n                    </Dropdown.Toggle>\n\n                    <Dropdown.Menu>\n                        {state.dishMask?.locked && <Dropdown.Item\n                            onClick={() => dispatch({ type: 'set_dish_mask_locked', value: false })}\n                        >Unlock</Dropdown.Item>}\n                        {!state.dishMask?.locked && <Dropdown.Item\n                            onClick={() => dispatch({ type: 'set_dish_mask_locked', value: true })}\n                        >Lock</Dropdown.Item>}\n\n                        <Dropdown.Item onClick={() => dispatch({ type: 'reset_dish_mask' })}>Reset to center</Dropdown.Item>\n                    </Dropdown.Menu>\n                </Dropdown>\n\n                <Button\n                    className=\"mx-2\"\n                    variant={helpVisible ? \"info\" : \"outline-info\"}\n                    onClick={() => setHelpVisible(!helpVisible)}\n                ><BiHelpCircle /></Button>\n\n                <Button onClick={returnToIndex}>Stop labeling</Button>\n            </Nav>\n        </Navbar>\n\n        {helpVisible && <Card border=\"info\" className=\"mb-2\">\n            <Card.Header>\n                <button className=\"float-end border-0\" onClick={() => setHelpVisible(!helpVisible)}>\n                    <CgCloseR />\n                </button>\n                Help\n            </Card.Header>\n            <Card.Body className=\"row\">\n                <dl className=\"col mb-0\">\n                    <dt>Space</dt>\n                    <dd>Advance through agents and frames</dd>\n                    <dt>b</dt>\n                    <dd>Reverse through agents and frames</dd>\n                </dl>\n                <dl className=\"col mb-0\">\n                    <dt>q/e/scroll</dt>\n                    <dd>Rotate selected agent</dd>\n                    <dt>w/a/s/d/drag</dt>\n                    <dd>Move selected agent</dd>\n                </dl>\n                <dl className=\"col mb-0\">\n                    <dt>Shift</dt>\n                    <dd>Rotate/move by 10x</dd>\n                </dl>\n            </Card.Body>\n        </Card>}\n    </>)\n}","import { useCallback, useContext, useEffect, useMemo, useState } from \"react\"\nimport { Col } from \"react-bootstrap\"\nimport point_in_polygon from \"robust-point-in-polygon\"\n\nimport agents from \"../agents.json\"\n\nimport './VideoLabeler.css'\nimport { LabelsDispatch } from \"./labels\"\nimport { Timeline } from \"./Timeline\"\nimport { Toolbar } from \"./Toolbar\"\nimport { getSrcForFrame } from \"./util\"\n\nfunction transform(x, y, angle, flipped) {\n    const matrix = new DOMMatrix([\n        Math.cos(angle), -Math.sin(angle),\n        Math.sin(angle), Math.cos(angle),\n        x, y\n    ])\n    if (flipped) {\n        matrix.multiplySelf(new DOMMatrix([\n            1, 0,\n            0, -1,\n            0, 0,\n        ]))\n    }\n    return matrix\n}\n\nconst DISH_MASK = Symbol('DISH_MASK')\n\nexport function VideoLabeler({ sample, state, returnToIndex }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    /** @type {React.MutableRefObject<HTMLCanvasElement>} */\n    const [preloadCanvas, setPreloadCanvas] = useState(null)\n    const [image, setImage] = useState(null)\n    useEffect(() => {\n        const element = document.createElement('img')\n\n        function imageLoaded() {\n            setImage(element)\n            dispatch({ type: 'set_loading_finished' })\n        }\n\n        element.addEventListener('load', imageLoaded)\n        element.src = getSrcForFrame(sample.id, state.activeFrame)\n\n        // The element will be garbage collected as long as this event listener isn't around creating a cycle\n        return () => element.removeEventListener('load', imageLoaded)\n    }, [dispatch, sample.id, state.activeFrame])\n\n    const dishMaskLocation = useMemo(() => {\n        if (!image) return null\n\n        const x = state.dishMask?.x ?? image.naturalWidth / 2\n        const y = state.dishMask?.y ?? image.naturalHeight / 2\n        const radius = state.dishMask?.radius ?? 500\n\n        return { x, y, radius }\n    }, [image, state])\n\n    const [canvas, setCanvas] = useState(null)\n    useEffect(() => {\n        if (preloadCanvas && image) {\n            preloadCanvas.width = image.naturalWidth\n            preloadCanvas.height = image.naturalHeight\n\n            preloadCanvas.getContext('2d').save()\n\n            setCanvas(preloadCanvas)\n        }\n    }, [preloadCanvas, image])\n\n    useEffect(() => {\n        if (!canvas) return\n        if (!dishMaskLocation) return\n\n        const ctx = canvas.getContext('2d')\n\n        ctx.restore()\n        ctx.save()\n\n        ctx.fillStyle = \"black\"\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n        ctx.beginPath()\n        const { x, y, radius } = dishMaskLocation\n        ctx.arc(x, y, radius, 0, Math.PI * 2)\n        ctx.clip()\n    }, [canvas, dishMaskLocation])\n\n\n    const getAgentLocation = useCallback(function (state, agent) {\n        if (!canvas) throw new Error(\"Canvas ref was cleared\")\n\n        if (agent === DISH_MASK) {\n            return dishMaskLocation\n        }\n\n        console.assert(typeof agent === \"string\")\n\n        const agentLabel = state.frames[state.activeFrame]?.[agent] ?? {}\n        const x = agentLabel.x ?? canvas.width / 2\n        const y = agentLabel.y ?? canvas.height / 2\n        const angle = agentLabel.angle ?? 0\n\n        return { x, y, angle }\n    }, [canvas, dishMaskLocation])\n\n    useEffect(() => {\n        if (!canvas) return\n        if (!image) return\n\n        const ctx = canvas.getContext('2d')\n        ctx.setTransform(1, 0, 0, 1, 0, 0)\n\n        ctx.drawImage(image, 0, 0)\n\n        ctx.lineWidth = 2\n\n        for (const agent of agents) {\n            if (!state.agentPresent[agent.name]) continue\n\n            if (agent.name === state.activeAgent) {\n                ctx.strokeStyle = 'red'\n                ctx.fillStyle = 'rgba(255, 0, 0, 0.2)'\n            } else {\n                ctx.strokeStyle = 'darkgrey'\n                ctx.fillStyle = 'rgba(0,0,0,0.2)'\n            }\n            const { x, y, angle } = getAgentLocation(state, agent.name)\n            const flipped = state.agentFlipped?.[agent.name]\n\n            ctx.setTransform(transform(x, y, angle, flipped))\n            ctx.beginPath()\n            for (const [shapeX, shapeY] of agent.shape) {\n                ctx.lineTo(shapeX, shapeY)\n            }\n            ctx.stroke()\n            ctx.fill()\n        }\n    }, [canvas, getAgentLocation, image, state])\n\n    useEffect(() => {\n        const activeAgentLabel = state.frames[state.activeFrame]?.[state.activeAgent] ?? {}\n\n        if (dispatch && image && (\n            typeof activeAgentLabel.x === \"undefined\" ||\n            typeof activeAgentLabel.y === \"undefined\")\n        ) {\n            dispatch({\n                type: 'set_agent_position',\n                agentName: state.activeAgent,\n                x: activeAgentLabel.x ?? image.naturalWidth / 2,\n                y: activeAgentLabel.y ?? image.naturalHeight / 2,\n            })\n        }\n    }, [dispatch, state, image])\n\n    // Preload next 3 frames\n    useEffect(() => {\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 1)\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 2)\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 3)\n    }, [sample.id, state.activeFrame])\n\n    function eventToImageCoordinates(event) {\n        if (!canvas) throw new Error(\"Canvas ref was cleared\")\n\n        const x = event.nativeEvent.offsetX * (canvas.height / canvas.clientHeight)\n        const y = event.nativeEvent.offsetY * (canvas.width / canvas.clientWidth)\n\n        return { x, y }\n    }\n\n    const [drag, setDrag] = useState(null)\n\n    function startDrag(x, y, agentName) {\n        if (!agentName) return\n\n        setDrag({\n            agentName,\n            mouse: { x, y },\n            agent: getAgentLocation(state, agentName)\n        })\n    }\n\n    function endDrag() {\n        setDrag(null)\n    }\n\n    function getHoveredAgent(x, y) {\n        for (const agent of agents) {\n            if (!state.agentPresent[agent.name]) continue\n\n            const agentPos = getAgentLocation(state, agent.name)\n            const xTranslated = x - agentPos.x\n            const yTranslated = y - agentPos.y\n            const xRotated = xTranslated * Math.cos(-agentPos.angle) + yTranslated * Math.sin(-agentPos.angle)\n            const yRotated = -xTranslated * Math.sin(-agentPos.angle) + yTranslated * Math.cos(-agentPos.angle)\n\n            if (point_in_polygon(agent.shape, [xRotated, yRotated]) <= 0) {\n                return agent.name\n            }\n        }\n\n        return null\n    }\n\n    function isDishMaskHovered(mouseX, mouseY) {\n        if (state.dishMask?.locked) return false\n        const { x: dishX, y: dishY, radius } = dishMaskLocation\n        const dist_sqr = (mouseX - dishX) ** 2 + (mouseY - dishY) ** 2\n        return dist_sqr > radius ** 2\n    }\n\n    function onCanvasMousedown(event) {\n        const { x, y } = eventToImageCoordinates(event)\n        if (isDishMaskHovered(x, y)) {\n            startDrag(x, y, DISH_MASK)\n            return\n        }\n\n        const hoveredAgent = getHoveredAgent(x, y)\n        if (hoveredAgent) {\n            dispatch({\n                type: 'set_active_agent',\n                activeAgent: hoveredAgent\n            })\n        }\n        startDrag(x, y, hoveredAgent ?? state.activeAgent)\n    }\n\n    function isDragging() {\n        return drag && (drag.agentName === state.activeAgent || drag.agentName === DISH_MASK)\n    }\n\n    function onCanvasMousemove(event) {\n        if (isDragging()) {\n            const xDelta = event.nativeEvent.offsetX * (canvas.height / canvas.clientHeight) - drag.mouse.x\n            const yDelta = event.nativeEvent.offsetY * (canvas.width / canvas.clientWidth) - drag.mouse.y\n\n            if (drag.agentName === DISH_MASK) {\n                dispatch({\n                    type: 'set_dish_mask_position',\n                    x: xDelta + drag.agent.x,\n                    y: yDelta + drag.agent.y,\n                })\n            } else {\n                dispatch({\n                    type: 'set_agent_position',\n                    agentName: drag.agentName,\n                    x: xDelta + drag.agent.x,\n                    y: yDelta + drag.agent.y,\n                })\n            }\n        }\n    }\n\n    function agentToScroll(x, y) {\n        // If dragging, rotate the agent being dragged. Otherwise, rotate the hovered agent (or dish). Otherwise,\n        // scroll the selected agent\n\n        if (isDragging()) return drag.agentName\n\n        if (isDishMaskHovered(x, y)) return DISH_MASK\n\n        return getHoveredAgent(x, y) ?? state.activeAgent\n    }\n\n    function onCanvasWheel(event) {\n        const { x, y } = eventToImageCoordinates(event)\n\n        const agentName = agentToScroll(x, y)\n\n        if (agentName === DISH_MASK) {\n            const { radius } = dishMaskLocation\n            dispatch({\n                type: 'set_dish_mask_radius',\n                radius: Math.max(10, radius + event.deltaY / (event.shiftKey ? 10 : 100)),\n            })\n        } else if (agentName) {\n            if (agentName !== state.activeAgent) {\n                dispatch({\n                    type: 'set_active_agent',\n                    activeAgent: agentName\n                })\n            }\n\n            dispatch({\n                type: 'rotate_agent',\n                agentName,\n                by: event.deltaY / (event.shiftKey ? 1000 : 10000),\n            })\n        }\n    }\n\n    return (<Col className=\"h-100 d-flex flex-column\">\n        <Toolbar sample={sample} state={state} returnToIndex={returnToIndex} />\n        <div className=\"labeler-canvas-container\">\n            <canvas\n                className=\"labeler-canvas\"\n                ref={setPreloadCanvas}\n                onMouseDown={onCanvasMousedown}\n                onMouseUp={endDrag}\n                onMouseMove={onCanvasMousemove}\n                onWheel={onCanvasWheel}\n            />\n            <Timeline sample={sample} state={state} />\n        </div>\n    </Col>)\n}","function updateFrame(state, agent, changes) {\n    if (!agent) return state\n    if (typeof changes === \"function\") {\n        changes = changes(state.frames[state.activeFrame]?.[agent] ?? {})\n    }\n    return {\n        ...state,\n        frames: {\n            ...state.frames,\n            [state.activeFrame]: {\n                ...state.frames[state.activeFrame],\n                [agent]: {\n                    ...state.frames[state.activeFrame]?.[agent] ?? {},\n                    ...changes\n                }\n            }\n        }\n    }\n}\n\nfunction normalizeAngle(angle) {\n    return angle % (Math.PI * 2)\n}\n\nfunction stepAdvanceDispatch(state) {\n    const presentAgentNames = Object.keys(state.agentPresent).filter(agentName => state.agentPresent[agentName])\n\n    // First, if there is no active agent, try to activate the first present agent\n    if (!state.activeAgent) {\n        if (presentAgentNames.length > 0) {\n            return { type: 'set_active_agent', activeAgent: presentAgentNames[0] }\n        } else {\n            // If there aren't any present agents, just go to the next frame\n            return { type: 'next_frame' }\n        }\n    }\n\n    // Try to activate the next present agent\n    const idx = presentAgentNames.indexOf(state.activeAgent)\n    if (idx < 0) {\n        throw new Error(\"Current agent is not present\")\n    } else if (idx + 1 < presentAgentNames.length) {\n        return { type: 'set_active_agent', activeAgent: presentAgentNames[idx + 1] }\n    }\n\n    // If nothing else worked, advance the frame and reset the agent\n    return { type: 'advance_frame_and_set_agent', activeAgent: presentAgentNames[0] }\n}\n\nfunction stepRetreatDispatch(state) {\n    const presentAgentNames = Object.keys(state.agentPresent).filter(agentName => state.agentPresent[agentName]).reverse()\n\n    // First, if there is no active agent, try to activate the first present agent\n    if (!state.activeAgent) {\n        if (presentAgentNames.length > 0) {\n            return { type: 'set_active_agent', activeAgent: presentAgentNames[0] }\n        }\n        throw new Error(\"Tried to retreat when no agents were active\")\n    }\n\n    // Try to activate the next present agent\n    const idx = presentAgentNames.indexOf(state.activeAgent)\n    if (idx < 0) {\n        throw new Error(\"Current agent is not present\")\n    } else if (idx + 1 < presentAgentNames.length) {\n        return { type: 'set_active_agent', activeAgent: presentAgentNames[idx + 1] }\n    }\n\n    // If nothing else worked, advance the frame and reset the agent\n    return { type: 'retreat_frame_and_set_agent', activeAgent: presentAgentNames[0] }\n}\n\nfunction clampFrame(settings, frameNum) {\n    // convert to 0-indexed for math\n    frameNum -= 1\n    // clamp to existing frames\n    frameNum = Math.max(0, Math.min(frameNum, settings.numFrames - 1))\n    // round to the sample rate\n    frameNum = Math.round(frameNum / settings.sampleRate) * settings.sampleRate\n    // convert back to 1-indexed\n    frameNum += 1\n    return frameNum\n}\n\nexport default function reducer(state, action) {\n    // The only action that can be performed before initial state is received is to receive the initial state\n    if (!state.settings && action.type !== 'set_state') {\n        console.warn(\"Received\", action.type, \"action before initial state from server\")\n        return state\n    }\n\n    switch (action.type) {\n        case 'set_state':\n            return action.state\n        case 'set_loading_finished':\n            return { ...state, loading: false }\n        case 'set_active_agent':\n            return { ...state, activeAgent: action.activeAgent }\n        case 'set_agent_present':\n            return { ...state, agentPresent: { ...state.agentPresent, [action.agent]: action.isPresent } }\n        case 'set_agent_flipped':\n            return { ...state, agentFlipped: { ...state.agentFlipped, [action.agent]: action.isFlipped } }\n        case 'active_agent_toggle_present':\n            return {\n                ...state,\n                agentPresent: { ...state.agentPresent, [state.activeAgent]: !state.agentPresent[state.activeAgent] }\n            }\n        case 'set_agent_position':\n            return updateFrame(state, action.agentName, { x: action.x, y: action.y })\n        case 'rotate_agent':\n            return updateFrame(state, action.agentName, agent => ({\n                angle: normalizeAngle((agent.angle || 0) + action.by)\n            }))\n        case 'rotate_active_agent':\n            return reducer(state, { type: 'rotate_agent', agentName: state.activeAgent, by: action.by})\n        case 'move_agent':\n            return updateFrame(state, action.agentName, agent => ({\n                x: (agent.x || 0) + (action.x || 0),\n                y: (agent.y || 0) + (action.y || 0),\n            }))\n        case 'move_active_agent':\n            return reducer(state, { type: 'move_agent', agentName: state.activeAgent, x: action.x, y: action.y })\n        case 'next_frame':\n            if (state.loading) return state\n            return {\n                ...state,\n                loading: true,\n                activeFrame: clampFrame(state.settings, state.activeFrame + state.settings.sampleRate),\n                frames: {\n                    ...state.frames,\n                    [state.activeFrame + 1]: state.frames[state.activeFrame + 1] ?? state.frames[state.activeFrame],\n                }\n            }\n        case 'previous_frame':\n            return {\n                ...state,\n                loading: true,\n                activeFrame: clampFrame(state.settings, state.activeFrame - state.settings.sampleRate)\n            }\n        case 'jump_to_frame':\n            return {\n                ...state,\n                loading: true,\n                activeFrame: clampFrame(state.settings, action.frame)\n            }\n        case 'set_agent_is_blurred':\n            return updateFrame(state, action.agentName, { isBlurred: action.isBlurred })\n        case 'toggle_active_agent_is_blurred':\n            return updateFrame(state, state.activeAgent, current => ({ isBlurred: !current.isBlurred }))\n        case 'set_agent_is_obscured':\n            return updateFrame(state, action.agentName, { isObscured: action.isObscured })\n        case 'toggle_active_agent_is_obscured':\n            return updateFrame(state, state.activeAgent, current => ({ isObscured: !current.isObscured }))\n        case 'step_advance':\n            return reducer(state, stepAdvanceDispatch(state))\n        case 'step_retreat':\n            return reducer(state, stepRetreatDispatch(state))\n        case 'advance_frame_and_set_agent':\n            if (state.loading) return state\n            return reducer(\n                reducer(state, { type: 'next_frame' }),\n                { type: 'set_active_agent', activeAgent: action.activeAgent })\n        case 'retreat_frame_and_set_agent':\n            if (state.loading) return state\n            return reducer(\n                reducer(state, { type: 'previous_frame' }),\n                { type: 'set_active_agent', activeAgent: action.activeAgent })\n        case 'set_dish_mask_position':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    x: action.x,\n                    y: action.y,\n                }\n            }\n        case 'set_dish_mask_radius':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    radius: action.radius,\n                }\n            }\n        case 'reset_dish_mask':\n            return {\n                ...state,\n                dishMask: null\n            }\n\n        case 'set_dish_mask_locked':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    locked: action.value\n                }\n            }\n\n        default:\n            throw new Error(\"Unknown reducer action\")\n    }\n}","import { useEffect, useMemo, useReducer, useState } from \"react\"\nimport { Container, Row } from \"react-bootstrap\"\nimport { Sidebar } from \"./Sidebar\"\nimport { VideoLabeler } from \"./VideoLabeler\"\nimport reducer from \"../reducer\"\nimport { LabelsDispatch } from \"./labels\"\nimport { apiBaseUrl } from \"./util\"\n\n// note only keys listed in save_state below are persisted to the server\nconst defaultState = {\n    settings: null,\n    loading: true,\n    activeFrame: 1,\n    activeAgent: null,\n    agentPresent: {},\n    frames: {}\n}\n\nconst NO_MATCH = Symbol(\"NO_MATCH\")\n\nexport default function Labeler() {\n    const [state, dispatch] = useReducer(reducer, defaultState, i => i)\n\n    const [sample, setSample] = useState(null)\n\n    const experimentId = useMemo(() => {\n        return new URL(window.location).searchParams.get(\"experiment_id\")\n    }, [])\n\n    useEffect(() => {\n        const controller = new AbortController()\n        const signal = controller.signal\n        fetch(`${apiBaseUrl}/api/experiment?id=${experimentId}`, { signal })\n          .then(response => response.json())\n          .then(sample => {\n              if (signal.aborted) {\n                  console.log(\"State restoration aborted after fetch finished\")\n                  return\n              }\n              setSample(sample)\n\n              const state = { ...defaultState, ...sample.label  }\n              // Have to do this weird inversion of object structure to get settings into redux\n              delete sample.label\n              state.settings = sample\n\n              dispatch({ type: 'set_state', state })\n          })\n          .catch(err => {\n              // AbortError is for intentional aborts using AbortController, so no handling is needed\n              if (err.name === 'AbortError') return\n\n              alert(`Failed to fetch experiment: ${err}`)\n          })\n\n        return () => controller.abort()\n    }, [experimentId])\n\n    useEffect(() => {\n        function listener(event) {\n            const ret = (() => {\n                switch (event.key) {\n                    // Changing frames\n                    case ' ':\n                        return dispatch({ type: 'step_advance' })\n                    case 'b':\n                        return dispatch({ type: 'step_retreat' })\n\n                    // Setting quality\n                    case 'r':\n                        return dispatch({ type: 'toggle_active_agent_is_blurred' })\n                    case 'f':\n                        return dispatch({ type: 'toggle_active_agent_is_obscured' })\n\n                    // Rotating\n                    case 'q':\n                        return dispatch({ type: 'rotate_active_agent', by: 0.01 })\n                    case 'Q':\n                        return dispatch({ type: 'rotate_active_agent', by: 0.1 })\n                    case 'e':\n                        return dispatch({ type: 'rotate_active_agent', by: -0.01 })\n                    case 'E':\n                        return dispatch({ type: 'rotate_active_agent', by: -0.1 })\n\n                    // Translating\n                    case 'w':\n                        return dispatch({ type: 'move_active_agent', y: -1 })\n                    case 'W':\n                        return dispatch({ type: 'move_active_agent', y: -10 })\n                    case 'a':\n                        return dispatch({ type: 'move_active_agent', x: -1 })\n                    case 'A':\n                        return dispatch({ type: 'move_active_agent', x: -10 })\n                    case 's':\n                        return dispatch({ type: 'move_active_agent', y: 1 })\n                    case 'S':\n                        return dispatch({ type: 'move_active_agent', y: 10 })\n                    case 'd':\n                        return dispatch({ type: 'move_active_agent', x: 1 })\n                    case 'D':\n                        return dispatch({ type: 'move_active_agent', x: 10 })\n\n                    default:\n                        break\n                }\n                return NO_MATCH\n            })()\n            if (ret !== NO_MATCH) event.preventDefault()\n            return ret\n        }\n\n        document.addEventListener('keypress', listener)\n        return () => document.removeEventListener('keypress', listener)\n    }, [])\n\n    // Save on every frame change\n    const hasSample = !!sample\n    useEffect(() => {\n        if (!hasSample || !state.settings) return\n        const save_state = Object.fromEntries(\n          [\"activeFrame\", \"activeAgent\", \"agentPresent\", \"frames\"]\n            .map(key => [key, state[key]])\n        )\n        fetch(`${apiBaseUrl}/api/set_label?id=${experimentId}`, {\n            method: \"POST\",\n            credentials: \"include\",\n            headers: {\n                'Content-Type': 'application/json'\n                // 'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: JSON.stringify(save_state)\n        })\n          .catch(err => {\n              alert(`Failed to save changes: ${err}`)\n          })\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [hasSample, state.activeFrame, experimentId])\n\n    function returnToIndex() {\n        window.location = `${apiBaseUrl}/`\n    }\n\n    if (!sample) return (<p>Loading&hellip;</p>)\n\n    return (<Container fluid className=\"h-100\">\n        <Row className=\"h-100\">\n            <LabelsDispatch.Provider value={dispatch}>\n                <Sidebar state={state} />\n                <VideoLabeler sample={sample} state={state} returnToIndex={returnToIndex} />\n            </LabelsDispatch.Provider>\n        </Row>\n    </Container>)\n}","import Labeler from \"./components/Labeler\"\n\nimport './App.css'\nimport 'bootstrap/dist/css/bootstrap.css';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Labeler />\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}