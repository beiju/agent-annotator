(this["webpackJsonplabelbox-annotator"]=this["webpackJsonplabelbox-annotator"]||[]).push([[0],{105:function(e,t,a){},113:function(e,t,a){},122:function(e,t,a){},123:function(e,t,a){},126:function(e,t,a){},128:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(18),s=a.n(c),i=(a(105),a(82)),l=a.n(i),o=a(88),u=a(7),d=a(80),j=a(141),v=a(142),b=a(145),m=a(48),f=a(91),g=a(47),h=Object(n.createContext)({}),O=(a(113),a(2));function p(e){var t=e.state,a=Object(n.useContext)(h);return a?Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{className:"text-center mt-3",children:"Agents Present"}),Object(O.jsx)("p",{className:"small text-secondary text-center",children:"Applies to the entire video"}),Object(O.jsx)("ol",{className:"list-unstyled m-3",children:g.map((function(e){var n,r,c,s;return Object(O.jsx)(x,{agent:e,active:e.name===t.activeAgent,onActivate:function(){return a({type:"set_active_agent",activeAgent:e.name})},checked:null!==(n=null===(r=t.agentPresent)||void 0===r?void 0:r[e.name])&&void 0!==n&&n,onChange:function(t){return a({type:"set_agent_present",agent:e.name,isPresent:t.currentTarget.checked})},flipped:null!==(c=null===(s=t.agentFlipped)||void 0===s?void 0:s[e.name])&&void 0!==c&&c,onFlip:function(t){return a({type:"set_agent_flipped",agent:e.name,isFlipped:t.currentTarget.checked})}},e.name)}))})]}):null}function x(e){var t=e.agent,a=e.checked,n=e.onChange,r=e.flipped,c=e.onFlip;return Object(O.jsxs)("li",{children:[Object(O.jsx)(b.a.Check,{type:"checkbox",id:t.name+"-active",label:t.display_name,checked:a,onChange:n}),Object(O.jsx)(b.a.Check,{className:"indented-checkbox",type:"checkbox",id:t.name+"-flip",label:"Flip",checked:r,onChange:c})]})}function _(e){var t,a,r=e.state,c=e.agent,s=e.label,i=Object(n.useContext)(h);return i?Object(O.jsxs)("li",{className:"list-group-item py-2 px-3 "+(r.activeAgent===c.name?"active":""),onClick:function(){return i({type:"set_active_agent",activeAgent:c.name})},children:[c.display_name,Object(O.jsxs)(b.a,{children:[Object(O.jsx)(m.a,{id:"agent-".concat(c.name,"-blurred"),label:"Blurred",checked:null!==(t=null===s||void 0===s?void 0:s.isBlurred)&&void 0!==t&&t,onChange:function(e){return i({type:"set_agent_is_blurred",agentName:c.name,isBlurred:e.currentTarget.checked})}}),Object(O.jsx)(m.a,{id:"agent-".concat(c.name,"-obscured"),label:"Obscured",checked:null!==(a=null===s||void 0===s?void 0:s.isObscured)&&void 0!==a&&a,onChange:function(e){return i({type:"set_agent_is_obscured",agentName:c.name,isObscured:e.currentTarget.checked})}})]})]}):null}function y(e){var t=e.state;return Object(O.jsxs)("div",{className:"flex-grow-1",children:[Object(O.jsx)("h4",{className:"text-center mt-3",children:"Agent Annotations"}),Object(O.jsx)("p",{className:"small text-secondary text-center",children:"Applies to the current frame"}),Object(O.jsx)("ul",{className:"list-group list-group-flush",children:g.map((function(e){var a,n,r;return(null===(a=t.agentPresent)||void 0===a?void 0:a[e.name])&&Object(O.jsx)(_,{state:t,agent:e,label:null===(n=t.frames)||void 0===n||null===(r=n[t.activeFrame])||void 0===r?void 0:r[e.name]},e.name)}))}),Object.values(t.agentPresent).every((function(e){return!e}))&&Object(O.jsx)("p",{className:"text-center mx-2",children:"Use the checkboxes below to select the agents that are present in this video"})]})}function k(e){var t=e.state;return Object(O.jsxs)(f.a,{md:4,lg:3,xl:2,className:"bg-light h-100 border-end border-dark d-flex flex-column gx-0",children:[Object(O.jsx)(y,{state:t}),Object(O.jsx)(p,{state:t})]})}var F=a(30),N=a(92),w=a.n(N),A=(a(122),a(3)),M=a(4),C=(a(123),a(98)),S=a(146),E=a(93),P=a(147);function T(e,t){return e?e.replace(".mp4","/".concat(String(t).padStart(3,"0"),".jpg")):""}var B=["popper","children","show"];function H(e,t){var a;return t===e.activeFrame?"active":(null===(a=e.frames)||void 0===a?void 0:a[t])?"labeled":"unlabeled"}var I=Object(n.forwardRef)((function(e,t){var a=e.popper,r=e.children,c=(e.show,Object(M.a)(e,B));return Object(n.useEffect)((function(){a.scheduleUpdate()}),[r,a]),Object(O.jsx)(C.a,Object(A.a)(Object(A.a)({ref:t,body:!0},c),{},{children:r}))}));function L(e){var t=e.sample,a=e.state,r=Object(n.useContext)(h),c=Object(n.useMemo)((function(){for(var e=[],n=null,r=0,c=1;c<=t.numFrames;c++){var s=H(a,c);s!==n&&null!==n&&(e.push({componentType:n,componentLength:r}),r=0),r+=1,n=s}return 0!==r&&e.push({componentType:n,componentLength:r}),e}),[t.numFrames,a]),s=Object(n.useState)(null),i=Object(u.a)(s,2),l=i[0],o=i[1],d=Object(n.useState)(null),j=Object(u.a)(d,2),v=j[0],b=j[1];var m=null===l?null:Math.min(Math.floor(l*t.numFrames),t.numFrames-1);return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)(S.a,{show:null!==v,onHide:function(){return b(null)},children:[Object(O.jsx)(S.a.Header,{closeButton:!0,children:Object(O.jsxs)(S.a.Title,{children:["Jump to frame ",v,"?"]})}),Object(O.jsx)(S.a.Body,{children:Object(O.jsx)("p",{children:"You will automatically start annotating at this position. Removing annotations is not yet supported, so be sure this is the frame you want."})}),Object(O.jsxs)(S.a.Footer,{children:[Object(O.jsx)(E.a,{onClick:function(){return b(null)},variant:"secondary",children:"Cancel"}),Object(O.jsx)(E.a,{onClick:function(){r({type:"jump_to_frame",frame:v}),b(null)},variant:"primary",children:"Jump to frame"})]})]}),Object(O.jsxs)("div",{className:"timeline",onMouseMove:function(e){var t=e.currentTarget.getBoundingClientRect(),a=(e.clientX-t.x)/t.width;o(Math.max(0,Math.min(a,1))),e.preventDefault()},onMouseLeave:function(){o(null)},onClick:function(){b(m)},children:[null!==m&&Object(O.jsx)(P.a,{show:!0,placement:"top",overlay:Object(O.jsx)(I,{className:"p-0",children:Object(O.jsx)("img",{src:T(t.data,m),alt:"Frame ".concat(m),height:180})}),children:Object(O.jsx)("div",{className:"timeline-cursor",style:{width:"min(2px, ".concat(100/t.numFrames,"%)"),left:"".concat(100*m/t.numFrames,"%")}})}),c.map((function(e,t){var a=e.componentType,n=e.componentLength;return Object(O.jsx)("div",{className:"timeline-component timeline-component-".concat(a),style:{flexGrow:n}},t)}))]})]})}var D=a(144),R=a(148),W=a(139),J=a(143),U=a(140),Y=a(149),V=a(83),K=a(96),X=a(97),q=a(84);function G(e){var t,a,r,c=e.sample,s=e.state,i=e.nextVideo,l=Object(n.useContext)(h),o=Object(n.useState)(!1),d=Object(u.a)(o,2),j=d[0],v=d[1],b=Object(n.useState)(!1),m=Object(u.a)(b,2),f=m[0],g=m[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)(D.a,{className:"d-flex justify-content-between",children:[Object(O.jsxs)(R.a,{children:[Object(O.jsxs)(D.a.Text,{className:"me-2",children:[Object(O.jsx)(W.a,{animation:"border",size:"sm",className:"me-2 ".concat(s.loading?"visible":"invisible")}),"Frame ",s.activeFrame," of ",c.numFrames]}),Object(O.jsxs)(J.a,{children:[Object(O.jsx)(J.a.Toggle,{variant:"danger",children:"Delete"}),Object(O.jsx)(J.a.Menu,{children:Object(O.jsx)(J.a.Item,{onClick:function(){return g(!0)},children:"Delete annotations after this frame"})})]})]}),Object(O.jsx)(R.a,{children:Object(O.jsxs)(U.a,{children:[Object(O.jsx)(E.a,{onClick:function(){return l({type:"previous_frame"})},disabled:s.activeFrame<=1,children:Object(O.jsx)(V.a,{})}),Object(O.jsx)(E.a,{onClick:function(){return l({type:"next_frame"})},disabled:s.activeFrame>=c.numFrames,children:Object(O.jsx)(V.b,{})})]})}),Object(O.jsxs)(R.a,{children:[Object(O.jsxs)(J.a,{children:[Object(O.jsxs)(J.a.Toggle,{children:[(null===(t=s.dishMask)||void 0===t?void 0:t.locked)?Object(O.jsx)(q.a,{style:{verticalAlign:"text-top"}}):Object(O.jsx)(q.b,{style:{verticalAlign:"text-top"}})," Dish mask"]}),Object(O.jsxs)(J.a.Menu,{children:[(null===(a=s.dishMask)||void 0===a?void 0:a.locked)&&Object(O.jsx)(J.a.Item,{onClick:function(){return l({type:"set_dish_mask_locked",value:!1})},children:"Unlock"}),!(null===(r=s.dishMask)||void 0===r?void 0:r.locked)&&Object(O.jsx)(J.a.Item,{onClick:function(){return l({type:"set_dish_mask_locked",value:!0})},children:"Lock"}),Object(O.jsx)(J.a.Item,{onClick:function(){return l({type:"reset_dish_mask"})},children:"Reset to center"})]})]}),Object(O.jsx)(E.a,{className:"mx-2",variant:j?"info":"outline-info",onClick:function(){return v(!j)},children:Object(O.jsx)(K.a,{})}),Object(O.jsx)(E.a,{onClick:i,children:"Next video"})]})]}),j&&Object(O.jsxs)(Y.a,{border:"info",className:"mb-2",children:[Object(O.jsxs)(Y.a.Header,{children:[Object(O.jsx)("button",{className:"float-end border-0",onClick:function(){return v(!j)},children:Object(O.jsx)(X.a,{})}),"Help"]}),Object(O.jsxs)(Y.a.Body,{className:"row",children:[Object(O.jsxs)("dl",{className:"col mb-0",children:[Object(O.jsx)("dt",{children:"Space"}),Object(O.jsx)("dd",{children:"Advance through agents and frames"}),Object(O.jsx)("dt",{children:"b"}),Object(O.jsx)("dd",{children:"Reverse through agents and frames"})]}),Object(O.jsxs)("dl",{className:"col mb-0",children:[Object(O.jsx)("dt",{children:"q/e/scroll"}),Object(O.jsx)("dd",{children:"Rotate selected agent"}),Object(O.jsx)("dt",{children:"w/a/s/d/drag"}),Object(O.jsx)("dd",{children:"Move selected agent"})]}),Object(O.jsxs)("dl",{className:"col mb-0",children:[Object(O.jsx)("dt",{children:"Shift"}),Object(O.jsx)("dd",{children:"Rotate/move by 10x"})]})]})]}),Object(O.jsxs)(S.a,{show:f,onHide:function(){return g(!1)},children:[Object(O.jsx)(S.a.Header,{closeButton:!0,children:Object(O.jsxs)(S.a.Title,{children:["Delete annotations after frame ",s.activeFrame,"?"]})}),Object(O.jsx)(S.a.Body,{children:Object(O.jsx)("p",{children:"This action cannot be undone."})}),Object(O.jsxs)(S.a.Footer,{children:[Object(O.jsx)(E.a,{onClick:function(){return g(!1)},variant:"secondary",children:"Cancel"}),Object(O.jsx)(E.a,{onClick:function(){l({type:"delete_annotations_after_frame",frame:s.activeFrame}),g(!1)},variant:"danger",children:"Delete"})]})]})]})}function z(e,t,a,n){var r=new DOMMatrix([Math.cos(a),-Math.sin(a),Math.sin(a),Math.cos(a),e,t]);return n&&r.multiplySelf(new DOMMatrix([1,0,0,-1,0,0])),r}var Q=Symbol("DISH_MASK");function Z(e){var t=e.sample,a=e.state,r=e.nextVideo,c=Object(n.useContext)(h),s=Object(n.useState)(null),i=Object(u.a)(s,2),l=i[0],o=i[1],d=Object(n.useState)(null),j=Object(u.a)(d,2),v=j[0],b=j[1];Object(n.useEffect)((function(){var e=document.createElement("img");function n(){b(e),c({type:"set_loading_finished"})}return e.addEventListener("load",n),e.src=T(t.data,a.activeFrame),function(){return e.removeEventListener("load",n)}}),[c,t.data,a.activeFrame]);var m=Object(n.useMemo)((function(){var e,t,n,r,c,s;return v?{x:null!==(e=null===(t=a.dishMask)||void 0===t?void 0:t.x)&&void 0!==e?e:v.naturalWidth/2,y:null!==(n=null===(r=a.dishMask)||void 0===r?void 0:r.y)&&void 0!==n?n:v.naturalHeight/2,radius:null!==(c=null===(s=a.dishMask)||void 0===s?void 0:s.radius)&&void 0!==c?c:500}:null}),[v,a]),p=Object(n.useState)(null),x=Object(u.a)(p,2),_=x[0],y=x[1];Object(n.useEffect)((function(){l&&v&&(l.width=v.naturalWidth,l.height=v.naturalHeight,l.getContext("2d").save(),y(l))}),[l,v]),Object(n.useEffect)((function(){if(_&&m){var e=_.getContext("2d");e.restore(),e.save(),e.fillStyle="black",e.fillRect(0,0,_.width,_.height),e.beginPath();var t=m.x,a=m.y,n=m.radius;e.arc(t,a,n,0,2*Math.PI),e.clip()}}),[_,m]);var k=Object(n.useCallback)((function(e,t){var a,n,r,c,s;if(!_)throw new Error("Canvas ref was cleared");if(t===Q)return m;console.assert("string"===typeof t);var i=null!==(a=null===(n=e.frames[e.activeFrame])||void 0===n?void 0:n[t])&&void 0!==a?a:{};return{x:null!==(r=i.x)&&void 0!==r?r:_.width/2,y:null!==(c=i.y)&&void 0!==c?c:_.height/2,angle:null!==(s=i.angle)&&void 0!==s?s:0}}),[_,m]);function N(e){if(!_)throw new Error("Canvas ref was cleared");return{x:e.nativeEvent.offsetX*(_.height/_.clientHeight),y:e.nativeEvent.offsetY*(_.width/_.clientWidth)}}Object(n.useEffect)((function(){if(_&&v){var e=_.getContext("2d");e.setTransform(1,0,0,1,0,0),e.drawImage(v,0,0),e.lineWidth=2;var t,n=Object(F.a)(g);try{for(n.s();!(t=n.n()).done;){var r,c=t.value;if(a.agentPresent[c.name]){c.name===a.activeAgent?(e.strokeStyle="red",e.fillStyle="rgba(255, 0, 0, 0.2)"):(e.strokeStyle="darkgrey",e.fillStyle="rgba(0,0,0,0.2)");var s=k(a,c.name),i=s.x,l=s.y,o=s.angle,d=null===(r=a.agentFlipped)||void 0===r?void 0:r[c.name];e.setTransform(z(i,l,o,d)),e.beginPath();var j,b=Object(F.a)(c.shape);try{for(b.s();!(j=b.n()).done;){var m=Object(u.a)(j.value,2),f=m[0],h=m[1];e.lineTo(f,h)}}catch(O){b.e(O)}finally{b.f()}e.stroke(),e.fill()}}}catch(O){n.e(O)}finally{n.f()}}}),[_,k,v,a]),Object(n.useEffect)((function(){var e,t,n,r,s=null!==(e=null===(t=a.frames[a.activeFrame])||void 0===t?void 0:t[a.activeAgent])&&void 0!==e?e:{};c&&v&&("undefined"===typeof s.x||"undefined"===typeof s.y)&&c({type:"set_agent_position",agentName:a.activeAgent,x:null!==(n=s.x)&&void 0!==n?n:v.naturalWidth/2,y:null!==(r=s.y)&&void 0!==r?r:v.naturalHeight/2})}),[c,a,v]),Object(n.useEffect)((function(){(new Image).src=T(t.data,a.activeFrame+1),(new Image).src=T(t.data,a.activeFrame+2),(new Image).src=T(t.data,a.activeFrame+3)}),[t.data,a.activeFrame]);var A=Object(n.useState)(null),M=Object(u.a)(A,2),C=M[0],S=M[1];function E(e,t,n){n&&S({agentName:n,mouse:{x:e,y:t},agent:k(a,n)})}function P(e,t){var n,r=Object(F.a)(g);try{for(r.s();!(n=r.n()).done;){var c=n.value;if(a.agentPresent[c.name]){var s=k(a,c.name),i=e-s.x,l=t-s.y,o=i*Math.cos(-s.angle)+l*Math.sin(-s.angle),u=-i*Math.sin(-s.angle)+l*Math.cos(-s.angle);if(w()(c.shape,[o,u])<=0)return c.name}}}catch(d){r.e(d)}finally{r.f()}return null}function B(e,t){var n;if(null===(n=a.dishMask)||void 0===n?void 0:n.locked)return!1;var r=m.x,c=m.y,s=m.radius;return Math.pow(e-r,2)+Math.pow(t-c,2)>Math.pow(s,2)}function H(){return C&&(C.agentName===a.activeAgent||C.agentName===Q)}return Object(O.jsxs)(f.a,{className:"h-100 d-flex flex-column",children:[Object(O.jsx)(G,{sample:t,state:a,nextVideo:r}),Object(O.jsxs)("div",{className:"labeler-canvas-container",children:[Object(O.jsx)("canvas",{className:"labeler-canvas",ref:o,onMouseDown:function(e){var t=N(e),n=t.x,r=t.y;if(B(n,r))E(n,r,Q);else{var s=P(n,r);s&&c({type:"set_active_agent",activeAgent:s}),E(n,r,null!==s&&void 0!==s?s:a.activeAgent)}},onMouseUp:function(){S(null)},onMouseMove:function(e){if(H()){var t=e.nativeEvent.offsetX*(_.height/_.clientHeight)-C.mouse.x,a=e.nativeEvent.offsetY*(_.width/_.clientWidth)-C.mouse.y;C.agentName===Q?c({type:"set_dish_mask_position",x:t+C.agent.x,y:a+C.agent.y}):c({type:"set_agent_position",agentName:C.agentName,x:t+C.agent.x,y:a+C.agent.y})}},onWheel:function(e){var t=N(e),n=function(e,t){var n;return H()?C.agentName:B(e,t)?Q:null!==(n=P(e,t))&&void 0!==n?n:a.activeAgent}(t.x,t.y);if(n===Q){var r=m.radius;c({type:"set_dish_mask_radius",radius:Math.max(10,r+e.deltaY/(e.shiftKey?10:100))})}else n&&(n!==a.activeAgent&&c({type:"set_active_agent",activeAgent:n}),c({type:"rotate_agent",agentName:n,by:e.deltaY/(e.shiftKey?1e3:1e4)}))}}),Object(O.jsx)(L,{sample:t,state:a})]})]})}var $=a(8);function ee(e,t,a){var n,r,c,s;if(!t)return e;"function"===typeof a&&(a=a(null!==(c=null===(s=e.frames[e.activeFrame])||void 0===s?void 0:s[t])&&void 0!==c?c:{}));return Object(A.a)(Object(A.a)({},e),{},{frames:Object(A.a)(Object(A.a)({},e.frames),{},Object($.a)({},e.activeFrame,Object(A.a)(Object(A.a)({},e.frames[e.activeFrame]),{},Object($.a)({},t,Object(A.a)(Object(A.a)({},null!==(n=null===(r=e.frames[e.activeFrame])||void 0===r?void 0:r[t])&&void 0!==n?n:{}),a)))))})}function te(e,t){var a;switch(t.type){case"set_state":return t.state.data===e.data?e:t.state;case"set_loading_finished":return Object(A.a)(Object(A.a)({},e),{},{loading:!1});case"set_active_agent":return Object(A.a)(Object(A.a)({},e),{},{activeAgent:t.activeAgent});case"set_agent_present":return Object(A.a)(Object(A.a)({},e),{},{agentPresent:Object(A.a)(Object(A.a)({},e.agentPresent),{},Object($.a)({},t.agent,t.isPresent))});case"set_agent_flipped":return Object(A.a)(Object(A.a)({},e),{},{agentFlipped:Object(A.a)(Object(A.a)({},e.agentFlipped),{},Object($.a)({},t.agent,t.isFlipped))});case"active_agent_toggle_present":return Object(A.a)(Object(A.a)({},e),{},{agentPresent:Object(A.a)(Object(A.a)({},e.agentPresent),{},Object($.a)({},e.activeAgent,!e.agentPresent[e.activeAgent]))});case"set_agent_position":return ee(e,t.agentName,{x:t.x,y:t.y});case"rotate_agent":return ee(e,t.agentName,(function(e){return{angle:(a=(e.angle||0)+t.by,a%(2*Math.PI))};var a}));case"rotate_active_agent":return te(e,{type:"rotate_agent",agentName:e.activeAgent,by:t.by});case"move_agent":return ee(e,t.agentName,(function(e){return{x:(e.x||0)+(t.x||0),y:(e.y||0)+(t.y||0)}}));case"move_active_agent":return te(e,{type:"move_agent",agentName:e.activeAgent,x:t.x,y:t.y});case"next_frame":return e.loading?e:Object(A.a)(Object(A.a)({},e),{},{loading:!0,activeFrame:e.activeFrame+1,frames:Object(A.a)(Object(A.a)({},e.frames),{},Object($.a)({},e.activeFrame+1,null!==(a=e.frames[e.activeFrame+1])&&void 0!==a?a:e.frames[e.activeFrame]))});case"previous_frame":return Object(A.a)(Object(A.a)({},e),{},{loading:!0,activeFrame:e.activeFrame>1?e.activeFrame-1:e.activeFrame});case"jump_to_frame":return Object(A.a)(Object(A.a)({},e),{},{loading:!0,activeFrame:t.frame});case"set_agent_is_blurred":return ee(e,t.agentName,{isBlurred:t.isBlurred});case"toggle_active_agent_is_blurred":return ee(e,e.activeAgent,(function(e){return{isBlurred:!e.isBlurred}}));case"set_agent_is_obscured":return ee(e,t.agentName,{isObscured:t.isObscured});case"toggle_active_agent_is_obscured":return ee(e,e.activeAgent,(function(e){return{isObscured:!e.isObscured}}));case"step_advance":return te(e,function(e){var t=Object.keys(e.agentPresent).filter((function(t){return e.agentPresent[t]}));if(!e.activeAgent)return t.length>0?{type:"set_active_agent",activeAgent:t[0]}:{type:"next_frame"};var a=t.indexOf(e.activeAgent);if(a<0)throw new Error("Current agent is not present");return a+1<t.length?{type:"set_active_agent",activeAgent:t[a+1]}:{type:"advance_frame_and_set_agent",activeAgent:t[0]}}(e));case"step_retreat":return te(e,function(e){var t=Object.keys(e.agentPresent).filter((function(t){return e.agentPresent[t]})).reverse();if(!e.activeAgent){if(t.length>0)return{type:"set_active_agent",activeAgent:t[0]};throw new Error("Tried to retreat when no agents were active")}var a=t.indexOf(e.activeAgent);if(a<0)throw new Error("Current agent is not present");return a+1<t.length?{type:"set_active_agent",activeAgent:t[a+1]}:{type:"retreat_frame_and_set_agent",activeAgent:t[0]}}(e));case"advance_frame_and_set_agent":return e.loading?e:te(te(e,{type:"next_frame"}),{type:"set_active_agent",activeAgent:t.activeAgent});case"retreat_frame_and_set_agent":return e.loading?e:te(te(e,{type:"previous_frame"}),{type:"set_active_agent",activeAgent:t.activeAgent});case"set_dish_mask_position":return Object(A.a)(Object(A.a)({},e),{},{dishMask:Object(A.a)(Object(A.a)({},e.dishMask),{},{x:t.x,y:t.y})});case"set_dish_mask_radius":return Object(A.a)(Object(A.a)({},e),{},{dishMask:Object(A.a)(Object(A.a)({},e.dishMask),{},{radius:t.radius})});case"reset_dish_mask":return Object(A.a)(Object(A.a)({},e),{},{dishMask:null});case"set_dish_mask_locked":return Object(A.a)(Object(A.a)({},e),{},{dishMask:Object(A.a)(Object(A.a)({},e.dishMask),{},{locked:t.value})});case"delete_annotations_after_frame":return Object(A.a)(Object(A.a)({},e),{},{frames:Object.fromEntries(Object.entries(e.frames).filter((function(e){var a=Object(u.a)(e,2),n=a[0];a[1];return n<=t.frame})))});default:throw new Error("Unknown reducer action")}}var ae={loading:!0,activeFrame:1,activeAgent:null,agentPresent:{},frames:{}},ne=Symbol("NO_MATCH");function re(){var e=Object(n.useReducer)(te,ae,(function(e){return e})),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(null),s=Object(u.a)(c,2),i=s[0],b=s[1];Object(n.useEffect)((function(){var e=d.a.currentAsset().subscribe(function(){var e=Object(o.a)(l.a.mark((function e(t){var a,n,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=13;break}return a=t.data.replace(".mp4","/num_frames.txt"),e.next=4,fetch(a);case 4:return n=e.sent,e.next=7,n.text();case 7:c=e.sent,t.numFrames=parseInt(c,10),(s=t.label?JSON.parse(t.label):ae).data=t.data,console.log("Restoring ",s),r({type:"set_state",state:s});case 13:b(t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return e.unsubscribe()}}),[]),Object(n.useEffect)((function(){function e(e){var t=function(){switch(e.key){case" ":return r({type:"step_advance"});case"b":return r({type:"step_retreat"});case"r":return r({type:"toggle_active_agent_is_blurred"});case"f":return r({type:"toggle_active_agent_is_obscured"});case"q":return r({type:"rotate_active_agent",by:.01});case"Q":return r({type:"rotate_active_agent",by:.1});case"e":return r({type:"rotate_active_agent",by:-.01});case"E":return r({type:"rotate_active_agent",by:-.1});case"w":return r({type:"move_active_agent",y:-1});case"W":return r({type:"move_active_agent",y:-10});case"a":return r({type:"move_active_agent",x:-1});case"A":return r({type:"move_active_agent",x:-10});case"s":return r({type:"move_active_agent",y:1});case"S":return r({type:"move_active_agent",y:10});case"d":return r({type:"move_active_agent",x:1});case"D":return r({type:"move_active_agent",x:10})}return ne}();return t!==ne&&e.preventDefault(),t}return document.addEventListener("keypress",e),function(){return document.removeEventListener("keypress",e)}}),[]);var m=!!i;return Object(n.useEffect)((function(){m&&d.a.setLabelForAsset(JSON.stringify(a)).catch((function(e){console.error(e)}))}),[m,a.activeFrame]),i?Object(O.jsx)(j.a,{fluid:!0,className:"h-100",children:Object(O.jsx)(v.a,{className:"h-100",children:Object(O.jsxs)(h.Provider,{value:r,children:[Object(O.jsx)(k,{state:a}),Object(O.jsx)(Z,{sample:i,state:a,nextVideo:function(){d.a.fetchNextAssetToLabel().catch((function(e){console.error(e)}))}})]})})}):Object(O.jsx)("p",{children:"Loading\u2026"})}a(126),a(127);var ce=function(){return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)(re,{})})},se=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,150)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),c(e),s(e)}))};s.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(ce,{})}),document.getElementById("root")),se()},47:function(e){e.exports=JSON.parse('[{"name":"gripper","display_name":"Gripper","shape":[[-143.92413189141612,51.84335246093342],[-48.072342656447375,79.81538314258269],[45.72914296233611,47.88919803209455],[143.44817449766214,86.51549575525146],[147.47556283000537,22.736344434302506],[96.40098497990128,-5.199072108746524],[137.55354949126553,-24.237623370279092],[147.47556658087464,-86.51565783567874],[62.49771702868982,-29.949191749434274],[-83.73301142993273,-62.60763712671145],[-147.47555142543342,-29.47323514143342],[-46.4247729973664,4.0639111158393595],[-143.92413189141612,51.84335246093342]]},{"name":"hammer","display_name":"Hammer","shape":[[-113.63075292686482,-9.350874622148904],[-116.24090468580708,3.186553654626621],[-99.65774142852855,9.350861919342712],[81.90005536895531,6.949524366319025],[116.24095042089394,-9.35087216357365],[-113.63075292686482,-9.350874622148904]]},{"name":"needle","display_name":"Needle","shape":[[132.86275165514863,4.463351744530263],[134.32539849455918,-3.465120001220135],[-124.05223857267488,-4.463450383742782],[-134.3255881557796,-0.05229539402387677],[-125.5729269962321,4.463335528244747],[132.86275165514863,4.463351744530263]]},{"name":"pillcam","display_name":"Pillcam","shape":[[4.585514267115303,-185.38631589799516],[30.79716156694573,-179.30770208979084],[58.632807234519504,-149.96188756251487],[66.15328787764503,-123.49601574811257],[60.67797622200067,118.25596658558737],[50.907420517050994,153.14917855033025],[17.137347004772277,181.6374592105472],[-14.405418787275961,185.38631586131314],[-44.38110096560142,172.17804277419],[-66.15331105269996,141.03368746021306],[-66.15330385277282,-122.5132723021791],[-50.81258336876257,-156.41994266409267],[-19.9945455511072,-180.40428224369262],[4.585514267115303,-185.38631589799516]]}]')}},[[128,1,2]]]);
//# sourceMappingURL=main.71806bd7.chunk.js.map