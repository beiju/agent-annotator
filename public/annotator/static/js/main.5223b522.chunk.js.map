{"version":3,"sources":["components/labels.js","components/Sidebar.js","components/util.js","components/Timeline.js","components/Toolbar.js","components/VideoLabeler.js","reducer.js","components/Labeler.js","App.js","reportWebVitals.js","index.js"],"names":["LabelsDispatch","createContext","SidebarAgentsPresent","state","dispatch","useContext","className","agents","map","agent","SidebarAgentPresent","active","name","activeAgent","onActivate","type","checked","agentPresent","onChange","event","isPresent","currentTarget","flipped","agentFlipped","onFlip","isFlipped","Form","Check","id","label","display_name","SidebarAgentAnnotation","onClick","FormCheck","isBlurred","agentName","isObscured","SidebarAgentAnnotations","frames","activeFrame","Object","values","every","x","Sidebar","Col","md","lg","xl","getSrcForFrame","sampleId","getComponentType","i","UpdatingPopover","forwardRef","ref","popper","children","props","show","useEffect","scheduleUpdate","Popover","body","Timeline","sample","components","useMemo","lastComponentType","componentLength","numFrames","componentType","push","useState","hoverPositionPercent","setHoverPositionPercent","wantsToNavigateToFrame","setWantsToNavigateToFrame","hoverPositionFrame","Math","min","floor","Modal","onHide","Header","closeButton","Title","Body","Footer","Button","variant","frame","onMouseMove","bounds","getBoundingClientRect","pct","clientX","width","max","preventDefault","onMouseLeave","OverlayTrigger","placement","overlay","src","alt","height","style","left","flexGrow","Toolbar","returnToIndex","helpVisible","setHelpVisible","Navbar","Nav","Text","Spinner","animation","size","loading","ButtonGroup","disabled","Dropdown","Toggle","dishMask","locked","verticalAlign","Menu","Item","value","Card","border","transform","y","angle","matrix","DOMMatrix","cos","sin","multiplySelf","DISH_MASK","Symbol","VideoLabeler","preloadCanvas","setPreloadCanvas","image","setImage","element","document","createElement","imageLoaded","addEventListener","removeEventListener","dishMaskLocation","naturalWidth","naturalHeight","radius","canvas","setCanvas","getContext","save","ctx","restore","fillStyle","fillRect","beginPath","arc","PI","clip","getAgentLocation","useCallback","Error","console","assert","agentLabel","eventToImageCoordinates","nativeEvent","offsetX","clientHeight","offsetY","clientWidth","setTransform","drawImage","lineWidth","strokeStyle","shape","shapeX","shapeY","lineTo","stroke","fill","activeAgentLabel","Image","drag","setDrag","startDrag","mouse","getHoveredAgent","agentPos","xTranslated","yTranslated","xRotated","yRotated","point_in_polygon","isDishMaskHovered","mouseX","mouseY","dishX","dishY","isDragging","onMouseDown","hoveredAgent","onMouseUp","xDelta","yDelta","onWheel","agentToScroll","deltaY","shiftKey","by","updateFrame","changes","reducer","action","current","presentAgentNames","keys","filter","length","idx","indexOf","stepAdvanceDispatch","reverse","stepRetreatDispatch","defaultState","NO_MATCH","Labeler","useReducer","setSample","experimentId","URL","window","location","searchParams","get","controller","AbortController","signal","fetch","then","response","json","aborted","log","catch","err","alert","abort","listener","ret","key","hasSample","method","credentials","headers","JSON","stringify","Container","fluid","Row","Provider","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5223b522.chunk.js","sourcesContent":["import { createContext } from \"react\"\n\nexport const LabelsDispatch = createContext({})","import { Col, Form, FormCheck } from \"react-bootstrap\"\n\nimport agents from \"../agents.json\"\nimport { useContext } from \"react\"\nimport { LabelsDispatch } from \"./labels\"\n\nimport \"./Sidebar.css\"\n\nfunction SidebarAgentsPresent({ state }) {\n    const dispatch = useContext(LabelsDispatch)\n    if (!dispatch) return null\n\n    return <div>\n        <h4 className=\"text-center mt-3\">Agents Present</h4>\n        <p className=\"small text-secondary text-center\">Applies to the entire video</p>\n\n        <ol className=\"list-unstyled m-3\">\n            {agents.map(agent => (\n                <SidebarAgentPresent\n                    key={agent.name}\n                    agent={agent}\n                    active={agent.name === state.activeAgent}\n                    onActivate={() => dispatch({\n                        type: 'set_active_agent',\n                        activeAgent: agent.name\n                    })}\n                    checked={state.agentPresent?.[agent.name] ?? false}\n                    onChange={event => dispatch({\n                        type: 'set_agent_present',\n                        agent: agent.name,\n                        isPresent: event.currentTarget.checked\n                    })}\n                    flipped={state.agentFlipped?.[agent.name] ?? false}\n                    onFlip={event => dispatch({\n                        type: 'set_agent_flipped',\n                        agent: agent.name,\n                        isFlipped: event.currentTarget.checked\n                    })}\n                />\n            ))}\n        </ol>\n    </div>\n}\n\nfunction SidebarAgentPresent({ agent, checked, onChange, flipped, onFlip }) {\n    return (<li>\n        <Form.Check\n            type=\"checkbox\"\n            id={agent.name + \"-active\"}\n            label={agent.display_name}\n            checked={checked}\n            onChange={onChange}\n        />\n        <Form.Check\n            className=\"indented-checkbox\"\n            type=\"checkbox\"\n            id={agent.name + \"-flip\"}\n            label=\"Flip\"\n            checked={flipped}\n            onChange={onFlip}\n        />\n    </li>)\n}\n\nfunction SidebarAgentAnnotation({ state, agent, label }) {\n    const dispatch = useContext(LabelsDispatch)\n    if (!dispatch) return null\n\n    return <li\n        className={\"list-group-item py-2 px-3 \" + (state.activeAgent === agent.name ? 'active' : '')}\n        onClick={() => dispatch({ type: 'set_active_agent', activeAgent: agent.name })}\n    >\n        {agent.display_name}\n        <Form>\n            <FormCheck\n                id={`agent-${agent.name}-blurred`}\n                label={\"Blurred\"}\n                checked={label?.isBlurred ?? false}\n                onChange={event => dispatch({\n                    type: 'set_agent_is_blurred',\n                    agentName: agent.name,\n                    isBlurred: event.currentTarget.checked\n                })}\n            />\n            <FormCheck\n                id={`agent-${agent.name}-obscured`}\n                label={\"Obscured\"}\n                checked={label?.isObscured ?? false}\n                onChange={event => dispatch({\n                    type: 'set_agent_is_obscured',\n                    agentName: agent.name,\n                    isObscured: event.currentTarget.checked\n                })}\n            />\n        </Form>\n    </li>\n}\n\nfunction SidebarAgentAnnotations({ state }) {\n    return <div className=\"flex-grow-1\">\n        <h4 className=\"text-center mt-3\">Agent Annotations</h4>\n        <p className=\"small text-secondary text-center\">Applies to the current frame</p>\n\n        <ul className=\"list-group list-group-flush\">\n            {agents.map(agent =>\n                state.agentPresent?.[agent.name] &&\n                <SidebarAgentAnnotation\n                    key={agent.name}\n                    state={state}\n                    agent={agent}\n                    label={state.frames?.[state.activeFrame]?.[agent.name]}\n                />\n            )}\n        </ul>\n        {Object.values(state.agentPresent).every(x => !x) && <p className=\"text-center mx-2\">\n            Use the checkboxes below to select the agents that are present in this video\n        </p>}\n    </div>\n}\n\nexport function Sidebar({ state }) {\n\n    return (<Col md={4} lg={3} xl={2} className=\"bg-light h-100 border-end border-dark d-flex flex-column gx-0\">\n        <SidebarAgentAnnotations state={state} />\n        <SidebarAgentsPresent state={state} />\n    </Col>)\n}","export function getSrcForFrame(sampleId, activeFrame) {\n    if (!sampleId) return \"\"\n    return `//127.0.0.1:8011/api/frame.jpg?experiment=${sampleId}&frame=${activeFrame}`\n}","import { forwardRef, useContext, useEffect, useMemo, useState } from \"react\"\n\nimport \"./Timeline.css\"\nimport { Button, Modal, OverlayTrigger, Popover } from \"react-bootstrap\"\nimport { getSrcForFrame } from \"./util\"\nimport { LabelsDispatch } from \"./labels\"\n\nfunction getComponentType(state, i) {\n    if (i === state.activeFrame) return 'active'\n    return state.frames?.[i] ? 'labeled' : 'unlabeled'\n}\n\n// The shell of this component is copied straight from react-bootstrap documentation\nconst UpdatingPopover = forwardRef(\n    ({ popper, children, show: _, ...props }, ref) => {\n        useEffect(() => {\n            popper.scheduleUpdate()\n        }, [children, popper])\n\n        return (\n            <Popover ref={ref} body {...props}>\n                {children}\n            </Popover>\n        )\n    },\n)\n\n\nexport function Timeline({ sample, state }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    const components = useMemo(() => {\n        const components = []\n        let lastComponentType = null\n        let componentLength = 0\n        for (let i = 1; i <= sample.numFrames; i++) {\n            const componentType = getComponentType(state, i)\n            if (componentType !== lastComponentType && lastComponentType !== null) {\n                components.push({ componentType: lastComponentType, componentLength })\n                componentLength = 0\n            }\n            componentLength += 1\n            lastComponentType = componentType\n        }\n\n        if (componentLength !== 0) {\n            components.push({ componentType: lastComponentType, componentLength })\n        }\n        return components\n    }, [sample.numFrames, state])\n\n    const [hoverPositionPercent, setHoverPositionPercent] = useState(null)\n    const [wantsToNavigateToFrame, setWantsToNavigateToFrame] = useState(null)\n\n    function onMouseMove(event) {\n        const bounds = event.currentTarget.getBoundingClientRect()\n        const pct = (event.clientX - bounds.x) / bounds.width\n\n        // Clamp to [0, 1]\n        setHoverPositionPercent(Math.max(0, Math.min(pct, 1)))\n        event.preventDefault()\n    }\n\n    function onMouseLeave() {\n        setHoverPositionPercent(null)\n    }\n\n    // This floor operation could return the `sample.numFrames`th frame, which doesn't exist\n    const hoverPositionFrame = hoverPositionPercent === null ? null :\n        Math.min(Math.floor(hoverPositionPercent * sample.numFrames), sample.numFrames - 1)\n\n    function onClick() {\n        setWantsToNavigateToFrame(hoverPositionFrame)\n    }\n\n    // This noinspection is because WebStorm thinks all arguments to OverlayTrigger are required, but most are optional\n    // noinspection RequiredAttributes\n    return (<>\n        <Modal show={wantsToNavigateToFrame !== null} onHide={() => setWantsToNavigateToFrame(null)}>\n            <Modal.Header closeButton>\n                <Modal.Title>Jump to frame {wantsToNavigateToFrame}?</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <p>\n                    You will automatically start annotating at this position. Removing annotations is not yet supported,\n                    so be sure this is the frame you want.\n                </p>\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={() => setWantsToNavigateToFrame(null)} variant=\"secondary\">Cancel</Button>\n                <Button onClick={() => {\n                    dispatch({ type: 'jump_to_frame', frame: wantsToNavigateToFrame })\n                    setWantsToNavigateToFrame(null)\n                }}\n                        variant=\"primary\">Jump to frame</Button>\n            </Modal.Footer>\n        </Modal>\n\n        <div className=\"timeline\"\n                 onMouseMove={onMouseMove}\n                 onMouseLeave={onMouseLeave}\n                 onClick={onClick}>\n\n            {hoverPositionFrame !== null && <OverlayTrigger show={true} placement={'top'} overlay={\n                <UpdatingPopover className=\"p-0\">\n                    <img\n                        src={getSrcForFrame(sample.id, hoverPositionFrame)}\n                        alt={`Frame ${hoverPositionFrame}`}\n                        height={180}\n                    />\n                </UpdatingPopover>\n            }>\n                <div className=\"timeline-cursor\" style={{\n                    width: `min(2px, ${100 / sample.numFrames}%)`,\n                    left: `${100 * hoverPositionFrame / sample.numFrames}%`,\n                }} />\n            </OverlayTrigger>}\n            {components.map(({ componentType, componentLength }, i) => (\n                <div key={i}\n                     className={`timeline-component timeline-component-${componentType}`}\n                     style={{ flexGrow: componentLength }} />\n            ))}\n        </div>\n    </>)\n}","import { useContext, useState } from \"react\"\nimport { LabelsDispatch } from \"./labels\"\nimport { Button, ButtonGroup, Card, Dropdown, Nav, Navbar, Spinner } from \"react-bootstrap\"\nimport { AiFillStepForward, AiFillStepBackward } from \"react-icons/ai\"\nimport { BiHelpCircle } from \"react-icons/bi\"\nimport { CgCloseR } from \"react-icons/cg\"\nimport { ImLock, ImUnlocked } from \"react-icons/im\"\n\nexport function Toolbar({ sample, state, returnToIndex }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    const [helpVisible, setHelpVisible] = useState(false)\n    return (<>\n        <Navbar className=\"d-flex justify-content-between\">\n            {/* Left */}\n            <Nav>\n                <Navbar.Text>\n                    <Spinner animation=\"border\" size=\"sm\" className={`me-2 ${state.loading ? 'visible' : 'invisible'}`} />\n                    Frame {state.activeFrame} of {sample.numFrames}\n                </Navbar.Text>\n            </Nav>\n\n            {/* Center */}\n            <Nav>\n                <ButtonGroup>\n                    <Button\n                        onClick={() => dispatch({ type: 'previous_frame' })}\n                        disabled={state.activeFrame <= 1}\n                    ><AiFillStepBackward /></Button>\n                    <Button\n                        onClick={() => dispatch({ type: 'next_frame' })}\n                        disabled={state.activeFrame >= sample.numFrames}\n                    ><AiFillStepForward /></Button>\n                </ButtonGroup>\n            </Nav>\n\n            {/* Right */}\n            <Nav>\n                <Dropdown>\n                    <Dropdown.Toggle>\n                        {state.dishMask?.locked ?\n                            <ImLock style={{ verticalAlign: \"text-top\" }} /> :\n                            <ImUnlocked style={{ verticalAlign: \"text-top\" }} />} Dish mask\n                    </Dropdown.Toggle>\n\n                    <Dropdown.Menu>\n                        {state.dishMask?.locked && <Dropdown.Item\n                            onClick={() => dispatch({ type: 'set_dish_mask_locked', value: false })}\n                        >Unlock</Dropdown.Item>}\n                        {!state.dishMask?.locked && <Dropdown.Item\n                            onClick={() => dispatch({ type: 'set_dish_mask_locked', value: true })}\n                        >Lock</Dropdown.Item>}\n\n                        <Dropdown.Item onClick={() => dispatch({ type: 'reset_dish_mask' })}>Reset to center</Dropdown.Item>\n                    </Dropdown.Menu>\n                </Dropdown>\n\n                <Button\n                    className=\"mx-2\"\n                    variant={helpVisible ? \"info\" : \"outline-info\"}\n                    onClick={() => setHelpVisible(!helpVisible)}\n                ><BiHelpCircle /></Button>\n\n                <Button onClick={returnToIndex}>Stop labeling</Button>\n            </Nav>\n        </Navbar>\n\n        {helpVisible && <Card border=\"info\" className=\"mb-2\">\n            <Card.Header>\n                <button className=\"float-end border-0\" onClick={() => setHelpVisible(!helpVisible)}>\n                    <CgCloseR />\n                </button>\n                Help\n            </Card.Header>\n            <Card.Body className=\"row\">\n                <dl className=\"col mb-0\">\n                    <dt>Space</dt>\n                    <dd>Advance through agents and frames</dd>\n                    <dt>b</dt>\n                    <dd>Reverse through agents and frames</dd>\n                </dl>\n                <dl className=\"col mb-0\">\n                    <dt>q/e/scroll</dt>\n                    <dd>Rotate selected agent</dd>\n                    <dt>w/a/s/d/drag</dt>\n                    <dd>Move selected agent</dd>\n                </dl>\n                <dl className=\"col mb-0\">\n                    <dt>Shift</dt>\n                    <dd>Rotate/move by 10x</dd>\n                </dl>\n            </Card.Body>\n        </Card>}\n    </>)\n}","import { useCallback, useContext, useEffect, useMemo, useState } from \"react\"\nimport { Col } from \"react-bootstrap\"\nimport point_in_polygon from \"robust-point-in-polygon\"\n\nimport agents from \"../agents.json\"\n\nimport './VideoLabeler.css'\nimport { LabelsDispatch } from \"./labels\"\nimport { Timeline } from \"./Timeline\"\nimport { Toolbar } from \"./Toolbar\"\nimport { getSrcForFrame } from \"./util\"\n\nfunction transform(x, y, angle, flipped) {\n    const matrix = new DOMMatrix([\n        Math.cos(angle), -Math.sin(angle),\n        Math.sin(angle), Math.cos(angle),\n        x, y\n    ])\n    if (flipped) {\n        matrix.multiplySelf(new DOMMatrix([\n            1, 0,\n            0, -1,\n            0, 0,\n        ]))\n    }\n    return matrix\n}\n\nconst DISH_MASK = Symbol('DISH_MASK')\n\nexport function VideoLabeler({ sample, state, returnToIndex }) {\n    const dispatch = useContext(LabelsDispatch)\n\n    /** @type {React.MutableRefObject<HTMLCanvasElement>} */\n    const [preloadCanvas, setPreloadCanvas] = useState(null)\n    const [image, setImage] = useState(null)\n    useEffect(() => {\n        const element = document.createElement('img')\n\n        function imageLoaded() {\n            setImage(element)\n            dispatch({ type: 'set_loading_finished' })\n        }\n\n        element.addEventListener('load', imageLoaded)\n        element.src = getSrcForFrame(sample.id, state.activeFrame)\n\n        // The element will be garbage collected as long as this event listener isn't around creating a cycle\n        return () => element.removeEventListener('load', imageLoaded)\n    }, [dispatch, sample.id, state.activeFrame])\n\n    const dishMaskLocation = useMemo(() => {\n        if (!image) return null\n\n        const x = state.dishMask?.x ?? image.naturalWidth / 2\n        const y = state.dishMask?.y ?? image.naturalHeight / 2\n        const radius = state.dishMask?.radius ?? 500\n\n        return { x, y, radius }\n    }, [image, state])\n\n    const [canvas, setCanvas] = useState(null)\n    useEffect(() => {\n        if (preloadCanvas && image) {\n            preloadCanvas.width = image.naturalWidth\n            preloadCanvas.height = image.naturalHeight\n\n            preloadCanvas.getContext('2d').save()\n\n            setCanvas(preloadCanvas)\n        }\n    }, [preloadCanvas, image])\n\n    useEffect(() => {\n        if (!canvas) return\n        if (!dishMaskLocation) return\n\n        const ctx = canvas.getContext('2d')\n\n        ctx.restore()\n        ctx.save()\n\n        ctx.fillStyle = \"black\"\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n        ctx.beginPath()\n        const { x, y, radius } = dishMaskLocation\n        ctx.arc(x, y, radius, 0, Math.PI * 2)\n        ctx.clip()\n    }, [canvas, dishMaskLocation])\n\n\n    const getAgentLocation = useCallback(function (state, agent) {\n        if (!canvas) throw new Error(\"Canvas ref was cleared\")\n\n        if (agent === DISH_MASK) {\n            return dishMaskLocation\n        }\n\n        console.assert(typeof agent === \"string\")\n\n        const agentLabel = state.frames[state.activeFrame]?.[agent] ?? {}\n        const x = agentLabel.x ?? canvas.width / 2\n        const y = agentLabel.y ?? canvas.height / 2\n        const angle = agentLabel.angle ?? 0\n\n        return { x, y, angle }\n    }, [canvas, dishMaskLocation])\n\n    useEffect(() => {\n        if (!canvas) return\n        if (!image) return\n\n        const ctx = canvas.getContext('2d')\n        ctx.setTransform(1, 0, 0, 1, 0, 0)\n\n        ctx.drawImage(image, 0, 0)\n\n        ctx.lineWidth = 2\n\n        for (const agent of agents) {\n            if (!state.agentPresent[agent.name]) continue\n\n            if (agent.name === state.activeAgent) {\n                ctx.strokeStyle = 'red'\n                ctx.fillStyle = 'rgba(255, 0, 0, 0.2)'\n            } else {\n                ctx.strokeStyle = 'darkgrey'\n                ctx.fillStyle = 'rgba(0,0,0,0.2)'\n            }\n            const { x, y, angle } = getAgentLocation(state, agent.name)\n            const flipped = state.agentFlipped?.[agent.name]\n\n            ctx.setTransform(transform(x, y, angle, flipped))\n            ctx.beginPath()\n            for (const [shapeX, shapeY] of agent.shape) {\n                ctx.lineTo(shapeX, shapeY)\n            }\n            ctx.stroke()\n            ctx.fill()\n        }\n    }, [canvas, getAgentLocation, image, state])\n\n    useEffect(() => {\n        const activeAgentLabel = state.frames[state.activeFrame]?.[state.activeAgent] ?? {}\n\n        if (dispatch && image && (\n            typeof activeAgentLabel.x === \"undefined\" ||\n            typeof activeAgentLabel.y === \"undefined\")\n        ) {\n            dispatch({\n                type: 'set_agent_position',\n                agentName: state.activeAgent,\n                x: activeAgentLabel.x ?? image.naturalWidth / 2,\n                y: activeAgentLabel.y ?? image.naturalHeight / 2,\n            })\n        }\n    }, [dispatch, state, image])\n\n    // Preload next 3 frames\n    useEffect(() => {\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 1)\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 2)\n        new Image().src = getSrcForFrame(sample.id, state.activeFrame + 3)\n    }, [sample.id, state.activeFrame])\n\n    function eventToImageCoordinates(event) {\n        if (!canvas) throw new Error(\"Canvas ref was cleared\")\n\n        const x = event.nativeEvent.offsetX * (canvas.height / canvas.clientHeight)\n        const y = event.nativeEvent.offsetY * (canvas.width / canvas.clientWidth)\n\n        return { x, y }\n    }\n\n    const [drag, setDrag] = useState(null)\n\n    function startDrag(x, y, agentName) {\n        if (!agentName) return\n\n        setDrag({\n            agentName,\n            mouse: { x, y },\n            agent: getAgentLocation(state, agentName)\n        })\n    }\n\n    function endDrag() {\n        setDrag(null)\n    }\n\n    function getHoveredAgent(x, y) {\n        for (const agent of agents) {\n            if (!state.agentPresent[agent.name]) continue\n\n            const agentPos = getAgentLocation(state, agent.name)\n            const xTranslated = x - agentPos.x\n            const yTranslated = y - agentPos.y\n            const xRotated = xTranslated * Math.cos(-agentPos.angle) + yTranslated * Math.sin(-agentPos.angle)\n            const yRotated = -xTranslated * Math.sin(-agentPos.angle) + yTranslated * Math.cos(-agentPos.angle)\n\n            if (point_in_polygon(agent.shape, [xRotated, yRotated]) <= 0) {\n                return agent.name\n            }\n        }\n\n        return null\n    }\n\n    function isDishMaskHovered(mouseX, mouseY) {\n        if (state.dishMask?.locked) return false\n        const { x: dishX, y: dishY, radius } = dishMaskLocation\n        const dist_sqr = (mouseX - dishX) ** 2 + (mouseY - dishY) ** 2\n        return dist_sqr > radius ** 2\n    }\n\n    function onCanvasMousedown(event) {\n        const { x, y } = eventToImageCoordinates(event)\n        if (isDishMaskHovered(x, y)) {\n            startDrag(x, y, DISH_MASK)\n            return\n        }\n\n        const hoveredAgent = getHoveredAgent(x, y)\n        if (hoveredAgent) {\n            dispatch({\n                type: 'set_active_agent',\n                activeAgent: hoveredAgent\n            })\n        }\n        startDrag(x, y, hoveredAgent ?? state.activeAgent)\n    }\n\n    function isDragging() {\n        return drag && (drag.agentName === state.activeAgent || drag.agentName === DISH_MASK)\n    }\n\n    function onCanvasMousemove(event) {\n        if (isDragging()) {\n            const xDelta = event.nativeEvent.offsetX * (canvas.height / canvas.clientHeight) - drag.mouse.x\n            const yDelta = event.nativeEvent.offsetY * (canvas.width / canvas.clientWidth) - drag.mouse.y\n\n            if (drag.agentName === DISH_MASK) {\n                dispatch({\n                    type: 'set_dish_mask_position',\n                    x: xDelta + drag.agent.x,\n                    y: yDelta + drag.agent.y,\n                })\n            } else {\n                dispatch({\n                    type: 'set_agent_position',\n                    agentName: drag.agentName,\n                    x: xDelta + drag.agent.x,\n                    y: yDelta + drag.agent.y,\n                })\n            }\n        }\n    }\n\n    function agentToScroll(x, y) {\n        // If dragging, rotate the agent being dragged. Otherwise, rotate the hovered agent (or dish). Otherwise,\n        // scroll the selected agent\n\n        if (isDragging()) return drag.agentName\n\n        if (isDishMaskHovered(x, y)) return DISH_MASK\n\n        return getHoveredAgent(x, y) ?? state.activeAgent\n    }\n\n    function onCanvasWheel(event) {\n        const { x, y } = eventToImageCoordinates(event)\n\n        const agentName = agentToScroll(x, y)\n\n        if (agentName === DISH_MASK) {\n            const { radius } = dishMaskLocation\n            dispatch({\n                type: 'set_dish_mask_radius',\n                radius: Math.max(10, radius + event.deltaY / (event.shiftKey ? 10 : 100)),\n            })\n        } else if (agentName) {\n            if (agentName !== state.activeAgent) {\n                dispatch({\n                    type: 'set_active_agent',\n                    activeAgent: agentName\n                })\n            }\n\n            dispatch({\n                type: 'rotate_agent',\n                agentName,\n                by: event.deltaY / (event.shiftKey ? 1000 : 10000),\n            })\n        }\n    }\n\n    return (<Col className=\"h-100 d-flex flex-column\">\n        <Toolbar sample={sample} state={state} returnToIndex={returnToIndex} />\n        <div className=\"labeler-canvas-container\">\n            <canvas\n                className=\"labeler-canvas\"\n                ref={setPreloadCanvas}\n                onMouseDown={onCanvasMousedown}\n                onMouseUp={endDrag}\n                onMouseMove={onCanvasMousemove}\n                onWheel={onCanvasWheel}\n            />\n            <Timeline sample={sample} state={state} />\n        </div>\n    </Col>)\n}","function updateFrame(state, agent, changes) {\n    if (!agent) return state\n    if (typeof changes === \"function\") {\n        changes = changes(state.frames[state.activeFrame]?.[agent] ?? {})\n    }\n    return {\n        ...state,\n        frames: {\n            ...state.frames,\n            [state.activeFrame]: {\n                ...state.frames[state.activeFrame],\n                [agent]: {\n                    ...state.frames[state.activeFrame]?.[agent] ?? {},\n                    ...changes\n                }\n            }\n        }\n    }\n}\n\nfunction normalizeAngle(angle) {\n    return angle % (Math.PI * 2)\n}\n\nfunction stepAdvanceDispatch(state) {\n    const presentAgentNames = Object.keys(state.agentPresent).filter(agentName => state.agentPresent[agentName])\n\n    // First, if there is no active agent, try to activate the first present agent\n    if (!state.activeAgent) {\n        if (presentAgentNames.length > 0) {\n            return { type: 'set_active_agent', activeAgent: presentAgentNames[0] }\n        } else {\n            // If there aren't any present agents, just go to the next frame\n            return { type: 'next_frame' }\n        }\n    }\n\n    // Try to activate the next present agent\n    const idx = presentAgentNames.indexOf(state.activeAgent)\n    if (idx < 0) {\n        throw new Error(\"Current agent is not present\")\n    } else if (idx + 1 < presentAgentNames.length) {\n        return { type: 'set_active_agent', activeAgent: presentAgentNames[idx + 1] }\n    }\n\n    // If nothing else worked, advance the frame and reset the agent\n    return { type: 'advance_frame_and_set_agent', activeAgent: presentAgentNames[0] }\n}\n\nfunction stepRetreatDispatch(state) {\n    const presentAgentNames = Object.keys(state.agentPresent).filter(agentName => state.agentPresent[agentName]).reverse()\n\n    // First, if there is no active agent, try to activate the first present agent\n    if (!state.activeAgent) {\n        if (presentAgentNames.length > 0) {\n            return { type: 'set_active_agent', activeAgent: presentAgentNames[0] }\n        }\n        throw new Error(\"Tried to retreat when no agents were active\")\n    }\n\n    // Try to activate the next present agent\n    const idx = presentAgentNames.indexOf(state.activeAgent)\n    if (idx < 0) {\n        throw new Error(\"Current agent is not present\")\n    } else if (idx + 1 < presentAgentNames.length) {\n        return { type: 'set_active_agent', activeAgent: presentAgentNames[idx + 1] }\n    }\n\n    // If nothing else worked, advance the frame and reset the agent\n    return { type: 'retreat_frame_and_set_agent', activeAgent: presentAgentNames[0] }\n}\n\nexport default function reducer(state, action) {\n    switch (action.type) {\n        case 'set_state':\n            return action.state\n        case 'set_loading_finished':\n            return { ...state, loading: false }\n        case 'set_active_agent':\n            return { ...state, activeAgent: action.activeAgent }\n        case 'set_agent_present':\n            return { ...state, agentPresent: { ...state.agentPresent, [action.agent]: action.isPresent } }\n        case 'set_agent_flipped':\n            return { ...state, agentFlipped: { ...state.agentFlipped, [action.agent]: action.isFlipped } }\n        case 'active_agent_toggle_present':\n            return {\n                ...state,\n                agentPresent: { ...state.agentPresent, [state.activeAgent]: !state.agentPresent[state.activeAgent] }\n            }\n        case 'set_agent_position':\n            return updateFrame(state, action.agentName, { x: action.x, y: action.y })\n        case 'rotate_agent':\n            return updateFrame(state, action.agentName, agent => ({\n                angle: normalizeAngle((agent.angle || 0) + action.by)\n            }))\n        case 'rotate_active_agent':\n            return reducer(state, { type: 'rotate_agent', agentName: state.activeAgent, by: action.by})\n        case 'move_agent':\n            return updateFrame(state, action.agentName, agent => ({\n                x: (agent.x || 0) + (action.x || 0),\n                y: (agent.y || 0) + (action.y || 0),\n            }))\n        case 'move_active_agent':\n            return reducer(state, { type: 'move_agent', agentName: state.activeAgent, x: action.x, y: action.y })\n        case 'next_frame':\n            if (state.loading) return state\n            return {\n                ...state,\n                loading: true,\n                activeFrame: state.activeFrame + 1,\n                frames: {\n                    ...state.frames,\n                    [state.activeFrame + 1]: state.frames[state.activeFrame + 1] ?? state.frames[state.activeFrame],\n                }\n            }\n        case 'previous_frame':\n            return {\n                ...state,\n                loading: true,\n                activeFrame: state.activeFrame > 1 ? state.activeFrame - 1 : state.activeFrame\n            }\n        case 'jump_to_frame':\n            return {\n                ...state,\n                loading: true,\n                activeFrame: action.frame\n            }\n        case 'set_agent_is_blurred':\n            return updateFrame(state, action.agentName, { isBlurred: action.isBlurred })\n        case 'toggle_active_agent_is_blurred':\n            return updateFrame(state, state.activeAgent, current => ({ isBlurred: !current.isBlurred }))\n        case 'set_agent_is_obscured':\n            return updateFrame(state, action.agentName, { isObscured: action.isObscured })\n        case 'toggle_active_agent_is_obscured':\n            return updateFrame(state, state.activeAgent, current => ({ isObscured: !current.isObscured }))\n        case 'step_advance':\n            return reducer(state, stepAdvanceDispatch(state))\n        case 'step_retreat':\n            return reducer(state, stepRetreatDispatch(state))\n        case 'advance_frame_and_set_agent':\n            if (state.loading) return state\n            return reducer(\n                reducer(state, { type: 'next_frame' }),\n                { type: 'set_active_agent', activeAgent: action.activeAgent })\n        case 'retreat_frame_and_set_agent':\n            if (state.loading) return state\n            return reducer(\n                reducer(state, { type: 'previous_frame' }),\n                { type: 'set_active_agent', activeAgent: action.activeAgent })\n        case 'set_dish_mask_position':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    x: action.x,\n                    y: action.y,\n                }\n            }\n        case 'set_dish_mask_radius':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    radius: action.radius,\n                }\n            }\n        case 'reset_dish_mask':\n            return {\n                ...state,\n                dishMask: null\n            }\n\n        case 'set_dish_mask_locked':\n            return {\n                ...state,\n                dishMask: {\n                    ...state.dishMask,\n                    locked: action.value\n                }\n            }\n\n        default:\n            throw new Error(\"Unknown reducer action\")\n    }\n}","import { useEffect, useMemo, useReducer, useState } from \"react\"\nimport { Container, Row } from \"react-bootstrap\"\nimport { Sidebar } from \"./Sidebar\"\nimport { VideoLabeler } from \"./VideoLabeler\"\nimport reducer from \"../reducer\"\nimport { LabelsDispatch } from \"./labels\"\n\nconst defaultState = {\n    loading: true,\n    activeFrame: 1,\n    activeAgent: null,\n    agentPresent: {},\n    frames: {}\n}\n\nconst NO_MATCH = Symbol(\"NO_MATCH\")\n\nexport default function Labeler() {\n    const [state, dispatch] = useReducer(reducer, defaultState, i => i)\n\n    const [sample, setSample] = useState(null)\n\n    const experimentId = useMemo(() => {\n        return new URL(window.location).searchParams.get(\"experiment_id\")\n    }, [])\n\n    useEffect(() => {\n        const controller = new AbortController()\n        const signal = controller.signal\n        fetch(`//127.0.0.1:8011/api/experiment?id=${experimentId}`, { signal })\n          .then(response => response.json())\n          .then(sample => {\n              if (signal.aborted) {\n                  console.log(\"State restoration aborted after fetch finished\")\n                  return\n              }\n              setSample(sample)\n\n              if (sample.label) {\n                  console.log(\"Restoring \", sample.label)\n                  dispatch({ type: 'set_state', state: sample.label })\n              } else {\n                  console.log(\"New sample\")\n                  dispatch({ type: 'set_state', state: defaultState })\n              }\n          })\n          .catch(err => {\n              // AbortError is for intentional aborts using AbortController, so no handling is needed\n              if (err.name === 'AbortError') return\n\n              alert(`Failed to fetch experiment: ${err}`)\n          })\n\n        return () => controller.abort()\n    }, [experimentId])\n\n    useEffect(() => {\n        function listener(event) {\n            const ret = (() => {\n                switch (event.key) {\n                    // Changing frames\n                    case ' ':\n                        return dispatch({ type: 'step_advance' })\n                    case 'b':\n                        return dispatch({ type: 'step_retreat' })\n\n                    // Setting quality\n                    case 'r':\n                        return dispatch({ type: 'toggle_active_agent_is_blurred' })\n                    case 'f':\n                        return dispatch({ type: 'toggle_active_agent_is_obscured' })\n\n                    // Rotating\n                    case 'q':\n                        return dispatch({ type: 'rotate_active_agent', by: 0.01 })\n                    case 'Q':\n                        return dispatch({ type: 'rotate_active_agent', by: 0.1 })\n                    case 'e':\n                        return dispatch({ type: 'rotate_active_agent', by: -0.01 })\n                    case 'E':\n                        return dispatch({ type: 'rotate_active_agent', by: -0.1 })\n\n                    // Translating\n                    case 'w':\n                        return dispatch({ type: 'move_active_agent', y: -1 })\n                    case 'W':\n                        return dispatch({ type: 'move_active_agent', y: -10 })\n                    case 'a':\n                        return dispatch({ type: 'move_active_agent', x: -1 })\n                    case 'A':\n                        return dispatch({ type: 'move_active_agent', x: -10 })\n                    case 's':\n                        return dispatch({ type: 'move_active_agent', y: 1 })\n                    case 'S':\n                        return dispatch({ type: 'move_active_agent', y: 10 })\n                    case 'd':\n                        return dispatch({ type: 'move_active_agent', x: 1 })\n                    case 'D':\n                        return dispatch({ type: 'move_active_agent', x: 10 })\n\n                    default:\n                        break\n                }\n                return NO_MATCH\n            })()\n            if (ret !== NO_MATCH) event.preventDefault()\n            return ret\n        }\n\n        document.addEventListener('keypress', listener)\n        return () => document.removeEventListener('keypress', listener)\n    }, [])\n\n    // Save on every frame change\n    const hasSample = !!sample\n    useEffect(() => {\n        if (!hasSample) return\n        fetch(`//127.0.0.1:8011/api/set_label?id=${experimentId}`, {\n            method: \"POST\",\n            credentials: \"include\",\n            headers: {\n                'Content-Type': 'application/json'\n                // 'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: JSON.stringify(state)\n        })\n          .catch(err => {\n              alert(`Failed to save changes: ${err}`)\n          })\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [hasSample, state.activeFrame, experimentId])\n\n    function returnToIndex() {\n        window.location = \"//127.0.0.1:8011/\"\n    }\n\n    if (!sample) return (<p>Loading&hellip;</p>)\n\n    return (<Container fluid className=\"h-100\">\n        <Row className=\"h-100\">\n            <LabelsDispatch.Provider value={dispatch}>\n                <Sidebar state={state} />\n                <VideoLabeler sample={sample} state={state} returnToIndex={returnToIndex} />\n            </LabelsDispatch.Provider>\n        </Row>\n    </Container>)\n}","import Labeler from \"./components/Labeler\"\n\nimport './App.css'\nimport 'bootstrap/dist/css/bootstrap.css';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Labeler />\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}